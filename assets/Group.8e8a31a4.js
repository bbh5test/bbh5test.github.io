import{_ as w,c as I,a as L,b as T,B as $,d as B,s as N,e as D,o as a,f as m,w as _,g as n,t as k,h as l,i as s,j as d,k as y,r as c,p as C,l as x,F as M}from"./index.68a2c8a6.js";import{D as P}from"./dialogBase.f04b6973.js";const U={name:"BlablaPay",inject:["reload"],components:{DialogBase:P},data(){return{contractAddress:"0x1BEcc0D044267540e81C1d203Eb7875ED9ff120F",jfTokenAddress:"0xaf22F677373352761B7F8FAfF4c9aD7bd8B6Be42",tradeHash:"N/A",tradeStatus:void 0,payWay:0,unUsedNum:0,tokenId:"0",isShowApprove:!1,isShowButton:!1,isConfirmLoading:!1,isApproveLoading:!1}},watch:{"$store.state.group.tradeVisable"(e){e&&this.init()}},computed:{tradeVisable:{get(){return this.$store.state.group.tradeVisable},set(e){this.$store.commit("setTradeVisable",e),this.tradeStatus==2&&this.reload()}},paymentType(){return this.$store.state.group.paymentType}},mounted(){},methods:{copy:I,async init(){if(this.tradeHash="N/A",this.tradeStatus=void 0,this.payWay=0,this.unUsedNum=0,this.tokenId="0",this.isShowApprove=!1,this.isShowButton=!1,this.isConfirmLoading=!1,this.isApproveLoading=!1,!await this.$store.dispatch("getPaymentListAction"))this.payWay=2;else{let o=this.$store.state.user.paymentList;if(o.length==0)this.payWay=2;else{let r=0;for(let u of o)this.paymentType==0?u.status==0&&u.paymentType==0&&(r=r+1):this.paymentType==1&&u.status==0&&u.paymentType==1&&(r=r+1);r>0?(this.payWay=1,this.unUsedNum=r):this.payWay=2}}this.isShowButton=!0},async changeTokenId(){this.tokenId==0&&(this.isShowButton=!0,this.isShowApprove=!1)},async payConfirm(){if(this.isConfirmLoading=!0,this.tokenId==1&&!await L({spender:this.contractAddress,tokenAddress:this.jfTokenAddress,account:this.$store.state.user.userAddress})){this.isShowButton=!1,this.isShowApprove=!0,this.$toast("\u8BF7\u5148\u6388\u6743"),this.isConfirmLoading=!1;return}if(this.payWay==1){let e=await this.trade();if(e=="fail")this.$toast.fail("\u652F\u4ED8\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u652F\u4ED8");else if(e=="success"){let o;this.paymentType==0?o="\u8D2D\u4E70\u7BA1\u7406\u5458\u6210\u529F":this.paymentType==1&&(o="\u8FDD\u89C4\u5904\u7F5A\u652F\u4ED8\u6210\u529F"),this.$toast.success(o),this.$store.commit("setTradeVisable",!1)}}else{if(console.log(await T()),!await T()){console.log("\u6821\u9A8C\u7F51\u7EDC\u548C\u8D26\u6237\u51FA\u9519"),this.$store.commit("logout"),this.$store.commit("setUserInfo",{}),this.$store.commit("setTradeVisable",!1),this.$store.dispatch("checkLogin"),this.isConfirmLoading=!1;return}this.tradeStatus=0,this.isShowButton=!1;try{let e=await $(this.contractAddress,this.paymentType,parseInt(this.tokenId));e&&(console.log(e),this.tradeHash=e.hash,this.tradeStatus=1,await this.timeCheckTrade())}catch{this.tradeStatus=-1}}this.isConfirmLoading=!1},async trade(){try{if(this.paymentType==0){if((await B.groupMember.buyManager(this.$store.state.group.groupId)).status==1)return await this.$store.dispatch("getGroupDetail",this.$route.params.groupId),this.$store.commit("setCurrentUserRole",1),"success"}else if(this.paymentType==1&&(await B.groupViolation.dealWithViolation(this.$store.state.group.groupId)).status==1)return this.$store.commit("setGroupStatus",0),this.$router.push({name:"GroupDetail",params:{groupId:this.$route.params.groupId}}),"success"}catch(e){console.log(e)}return"fail"},async timeCheckTrade(){console.log("timeCheckTrade");let e=!1,o=setTimeout(async function(){e=!0},6e4);for(;;){try{if(await this.trade()=="success"){this.tradeStatus=2,clearTimeout(o);break}}catch(r){console.log(r)}if(e){this.tradeStatus=-2;break}await N(3e3)}},async approve(){this.isApproveLoading=!0;try{let e=await D(this.contractAddress,this.jfTokenAddress);e&&(this.isShowApprove=!1,this.isShowButton=!0),console.log(e)}catch(e){console.log(e)}finally{this.isApproveLoading=!1}},jumpToTxDetail(){window.open("https://rinkeby.etherscan.io/tx/"+this.tradeHash,"_blank")},jumpToPaymentList(){this.$store.commit("setTradeVisable",!1),this.$router.push({name:"PaymentList"})}}},A=e=>(C("data-v-ee04d780"),e=e(),x(),e),j={key:0,class:"pay-way"},F={key:1,class:"has-unused"},W={key:0},z={key:1},H={key:2,class:"no-unused"},G={key:0},E={key:1},O=y("\u652F\u4ED8 1 BNB"),R=y("\u652F\u4ED8 200 JF"),q=y("approve"),J={key:1,class:"status-content"},K={class:"status-text"},Q={key:0},X={key:1},Y={key:2},Z={key:3},ee={class:"status-icon"},te={class:"trade-hash"},se=y(" \u4EA4\u6613Hash\uFF1A "),oe={key:0},ae=A(()=>s("use",{"xlink:href":"#icon-copy"},null,-1)),ie=[ae],ne={key:1},re=A(()=>s("span",null,"N/A",-1)),ce=[re];function le(e,o,r,u,t,i){const h=c("van-loading"),g=c("van-radio"),v=c("van-radio-group"),b=c("van-button"),S=c("van-icon"),V=c("DialogBase");return a(),m(V,{class:"trade-box",autoClose:!1,clickOverlayIsClose:!1,visible:i.tradeVisable,"onUpdate:visible":o[4]||(o[4]=p=>i.tradeVisable=p),title:typeof t.tradeStatus!="number"?"\u63D0\u793A":"\u4EA4\u6613\u8BE6\u60C5",showConfirmButton:t.isShowButton,showCancelButton:t.isShowButton,onOnConfirm:i.payConfirm,confirmLoading:t.isConfirmLoading},{default:_(()=>[typeof t.tradeStatus!="number"?(a(),n("div",j,[t.payWay==0?(a(),m(h,{key:0,type:"spinner",size:"48px"})):t.payWay==1?(a(),n("div",F,[i.paymentType==1?(a(),n("span",W," \u4F60\u6709"+k(t.unUsedNum)+"\u6B21\u672A\u4F7F\u7528\u7684\u652F\u4ED8\u8BB0\u5F55\u53EF\u7528\u4E8E\u8FDD\u89C4\u5904\u7F5A\uFF0C\u4E00\u65E6\u4F60\u5904\u7406\u4E86\u8FD9\u6B21\u8FDD\u89C4\uFF0C\u5C31\u4F1A\u4F7F\u7528\u4E00\u6761\u652F\u4ED8\u8BB0\u5F55\u3002 ",1)):i.paymentType==0?(a(),n("span",z," \u4F60\u6709"+k(t.unUsedNum)+"\u6B21\u672A\u4F7F\u7528\u7684\u652F\u4ED8\u8BB0\u5F55\u53EF\u7528\u4E8E\u7BA1\u7406\u5458\u8D2D\u4E70\uFF0C\u4E00\u65E6\u4F60\u8D2D\u4E70\u4E86\u7BA1\u7406\u5458\uFF0C\u5C31\u4F1A\u4F7F\u7528\u4E00\u6761\u652F\u4ED8\u8BB0\u5F55\u3002 ",1)):l("",!0)])):t.payWay==2?(a(),n("div",H,[s("label",null,[i.paymentType==1?(a(),n("span",G,"\u9009\u62E9\u4E00\u79CD\u65B9\u5F0F\u652F\u4ED8\u8FDD\u89C4\u5904\u7F5A")):i.paymentType==0?(a(),n("span",E,"\u9009\u62E9\u4E00\u79CD\u65B9\u5F0F\u8D2D\u4E70\u7BA1\u7406\u5458")):l("",!0)]),d(v,{modelValue:t.tokenId,"onUpdate:modelValue":o[0]||(o[0]=p=>t.tokenId=p),onChange:i.changeTokenId},{default:_(()=>[d(g,{class:"radio-item","checked-color":"#9505F9","icon-size":"16px",name:"0"},{default:_(()=>[O]),_:1}),d(g,{class:"radio-item","checked-color":"#9505F9","icon-size":"16px",name:"1"},{default:_(()=>[R]),_:1})]),_:1},8,["modelValue","onChange"])])):l("",!0),t.isShowApprove?(a(),m(b,{key:3,class:"approve",round:"",type:"primary",onClick:i.approve,loading:t.isApproveLoading},{default:_(()=>[q]),_:1},8,["onClick","loading"])):l("",!0)])):(a(),n("div",J,[s("div",K,[t.tradeStatus==0?(a(),n("span",Q,"\u53D1\u9001\u4EA4\u6613\u5230\u533A\u5757\u94FE...")):t.tradeStatus==1?(a(),n("span",X,"\u7B49\u5F85\u670D\u52A1\u5668\u540C\u6B65...")):t.tradeStatus==-1?(a(),n("span",Y,"\u4E0A\u94FE\u4EA4\u6613\u53D1\u9001\u5931\u8D25")):t.tradeStatus==-2?(a(),n("span",Z,"\u670D\u52A1\u5668\u540C\u6B65\u8D85\u65F6")):l("",!0)]),s("div",ee,[t.tradeStatus==0||t.tradeStatus==1?(a(),m(h,{key:0,type:"spinner",size:"48px"})):l("",!0),t.tradeStatus==2?(a(),m(S,{key:1,color:"#07c160",size:"40px",name:"checked"})):l("",!0),t.tradeStatus==-1||t.tradeStatus==-2?(a(),m(S,{key:2,color:"#FA5151",size:"40px",name:"clear"})):l("",!0)]),s("div",te,[se,t.tradeStatus==1||t.tradeStatus==2||t.tradeStatus==-2?(a(),n("text",oe,[s("span",{onClick:o[1]||(o[1]=(...p)=>i.jumpToTxDetail&&i.jumpToTxDetail(...p))},k(e.$f.formatAddress(t.tradeHash,6)),1),(a(),n("svg",{class:"icon-svg icon-renzheng","aria-hidden":"true",onClick:o[2]||(o[2]=p=>i.copy(t.tradeHash))},ie))])):t.tradeStatus==0||t.tradeStatus==-1?(a(),n("text",ne,ce)):l("",!0)]),t.tradeStatus==2||t.tradeStatus==-2?(a(),n("div",{key:0,class:"check-trade-list",onClick:o[3]||(o[3]=(...p)=>i.jumpToPaymentList&&i.jumpToPaymentList(...p))}," \u67E5\u770B\u652F\u4ED8\u8BB0\u5F55 ")):l("",!0)]))]),_:1},8,["visible","title","showConfirmButton","showCancelButton","onOnConfirm","confirmLoading"])}const de=w(U,[["render",le],["__scopeId","data-v-ee04d780"]]);const pe={name:"BecomeManager",props:{visible:Boolean},components:{},data(){return{}},computed:{dialogVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}}},watch:{},methods:{becomeManager(){this.$store.commit("setTradeVisable",!0),this.$store.commit("setPaymentType",0),this.dialogVisible=!1}},created(){},mounted(){}},f=e=>(C("data-v-db27ec0e"),e=e(),x(),e),ue=f(()=>s("h3",{class:"title"}," \u6210\u4E3A\u7BA1\u7406\u5458 ",-1)),he={class:"content"},me=f(()=>s("div",{class:"info"},[y("\u7BA1\u7406\u5458\u5E2D\u4F4D\u8FD8\u6709"),s("span",null,"5"),y("\u4E2A\uFF0C\u4F60\u53EF\u4EE5\u6210\u4E3A\u6B64Token\u7FA4\u7684\u7BA1\u7406\u5458")],-1)),_e={class:"privilege"},ye=f(()=>s("div",{class:"privilege-info"},"\u6210\u4E3A\u7BA1\u7406\u5458\u540E\uFF0C\u60A8\u5C06\u62E5\u6709\u4EE5\u4E0B\u7279\u6743\uFF1A",-1)),fe={class:"privilege-list"},ge=f(()=>s("div",{class:"item"},[s("div",{class:"img"},[s("i",{class:"iconfont icon-kick"})]),s("div",{class:"text"}," \u7981\u8A00\u6216\u8E22\u51FA ")],-1)),ve=f(()=>s("div",{class:"item"},[s("div",{class:"img"},[s("i",{class:"iconfont icon-zhiding"})]),s("div",{class:"text"}," \u7F6E\u9876\u6D88\u606F ")],-1)),be={class:"item"},ke={class:"img"},we=f(()=>s("div",{class:"text"}," \u7BA1\u7406\u7FA4\u7EC4 ",-1)),Se={class:"item"},Te={class:"img"},Be=f(()=>s("div",{class:"text"}," \u66F4\u591A\u7279\u6743 ",-1)),Ce={class:"action-bar"},xe=y("\u786E\u5B9A ");function Ae(e,o,r,u,t,i){const h=c("van-icon"),g=c("van-button"),v=c("van-popup");return a(),m(v,{show:i.dialogVisible,"onUpdate:show":o[0]||(o[0]=b=>i.dialogVisible=b),closeable:!0,round:"",position:"center",teleport:"#app",class:"become-manager"},{default:_(()=>[ue,s("div",he,[me,s("div",_e,[ye,s("div",fe,[ge,ve,s("div",be,[s("div",ke,[d(h,{class:"icon-svg",size:"1.3em",name:"/assets/images/set.png"})]),we]),s("div",Se,[s("div",Te,[d(h,{class:"icon-svg",size:"1.3em",name:"/assets/images/tequan.png"})]),Be])])])]),s("div",Ce,[d(g,{type:"primary",class:"btn",onClick:i.becomeManager},{default:_(()=>[xe]),_:1},8,["onClick"])])]),_:1},8,["show"])}const Ve=w(pe,[["render",Ae],["__scopeId","data-v-db27ec0e"]]),Ie={name:"Group",components:{BlablaPay:de,BecomeManager:Ve},computed:{becomeManagerVisible:{get(){return this.$store.state.group.becomeManagerVisible},set(e){this.$store.commit("setBecomeManagerVisible",e)}}},mounted(){console.log(this.$route.params.groupId)}};function Le(e,o,r,u,t,i){const h=c("router-view"),g=c("become-manager"),v=c("BlablaPay");return a(),n(M,null,[d(h),d(g,{visible:i.becomeManagerVisible,"onUpdate:visible":o[0]||(o[0]=b=>i.becomeManagerVisible=b)},null,8,["visible"]),d(v)],64)}const De=w(Ie,[["render",Le]]);export{De as default};
