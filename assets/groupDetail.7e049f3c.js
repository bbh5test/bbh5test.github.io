import{_ as T,e as I,c as N,h as i,j as r,k as s,ad as V,w as g,g as p,i as l,t as m,u as b,v as k,r as d,o as a,F as j,x as S,l as v,p as G,m as x}from"./index.84cb370a.js";import{M as z}from"./memberItem.5e265f0a.js";import{A as D}from"./avatar.8f6daa6f.js";import"./roleTag.47df83d7.js";const U={name:"GroupDetail",inject:["reload"],components:{MemberItem:z,Avatar:D},watch:{},computed:{groupInfo(){var t;return(t=this.$store.state)==null?void 0:t.group}},mounted(){console.log(this.pageNumber),this.init()},data(){return{becomeManagerVisible:!1,groupMemberList:[],loading:!1,finished:!1,error:!1,pageSize:50,pageNumber:1}},methods:{async init(){let t=this.$toast.loading({message:"Loading...",forbidClick:!0,duration:0});this.loading=!1,this.finished=!1,this.error=!1,this.pageNumber=1;try{await this.getMemberList()}catch(o){console.log(o)}finally{t.clear()}},async getMemberList(){this.loading=!0;try{let t=this.groupInfo.groupId;if(!t)return;let o=await I.groupMember.getMemberList(t,this.pageSize,this.pageNumber,[0,1,2]);console.log(o),this.pageNumber==1&&(this.groupMemberList=[]),o.status==1?(this.groupMemberList=this.groupMemberList.concat(o.data),o.data.length<this.pageSize||this.groupMemberList.length>=this.groupInfo.totalMembers?this.finished=!0:(this.pageNumber++,console.log(this.pageNumber))):this.error=!0}catch{this.error=!0}finally{setTimeout(()=>{this.loading=!1},1e3)}},editGroup(){this.$router.push({name:"GroupSet",params:{groupId:this.groupInfo.groupId}})},shareLink(){let t=window.document.location.host+"/group/"+this.groupInfo.groupId+"/chat";N(t)},openBecomeManager(){this.$store.commit("setBecomeManagerVisible",!0)},jumpToViolation(){(this.groupInfo.status==2||this.groupInfo.status==3)&&this.$router.push({name:"DealWithViolation",params:{groupId:this.groupInfo.groupId}})},jumpToEditOfficial(){this.$router.push({name:"GroupOfficialSet",params:{groupId:this.groupInfo.groupId}})},jumpToBanned(){this.$router.push({name:"Banned",params:{groupId:this.groupInfo.groupId}})},jumpAddViolation(){this.$router.push({name:"AddViolation",params:{groupId:this.groupInfo.groupId}})},leaveGroup(){this.$dialog.confirm({title:"\u63D0\u793A",message:"\u662F\u5426\u9000\u51FA\u7FA4\u804A",confirmButtonText:"\u786E\u8BA4",confirmButtonColor:"#3F80F7",cancelButtonText:this.$t("cancel")}).then(async()=>{try{(await I.group.leave(this.groupInfo.groupId)).status==1&&this.$router.push("/chats")}catch(t){console.log(t)}}).catch(()=>{})}}},y=t=>(G("data-v-e804fcaf"),t=t(),x(),t),A={class:"group-detail"},F={class:"group-content"},J={class:"section-top"},E={class:"nickname"},O={key:0,class:"svg-box"},R={key:1,class:"svg-box"},W={class:"members"},q={class:"section-center"},H={class:"chain-name"},K={key:0,class:"section-btn"},P=v("\u5206\u4EAB\u7FA4\u94FE\u63A5"),Q=v("\u7BA1\u7406\u5458"),X={key:0,class:"weigui-handle"},Y={key:1,class:"official-renzheng"},Z={class:"left-title"},$=y(()=>r("span",{class:"custom-title"},"\u5F00\u901A\u9879\u76EE\u5B98\u65B9\u8BA4\u8BC1",-1)),ee={class:"svg-box"},te={class:"member-box"},oe=v(" \u67E5\u770B\u7981\u8A00\u5217\u8868 "),re={class:"member-list"},se={key:2,class:"bottom-operate"},ae={key:0,class:"type-1"},ne=y(()=>r("div",null,"\u5904\u7F5A\u8FDD\u89C4",-1)),ie=[ne],le={key:1,class:"type-2"};function ue(t,o,de,ce,u,e){const f=d("van-icon"),M=d("van-nav-bar"),C=d("Avatar"),h=d("van-image"),c=d("van-cell"),_=d("van-button"),L=d("MemberItem"),w=d("van-empty"),B=d("van-list");return a(),i("div",A,[r("div",null,[s(M,{onClickLeft:o[0]||(o[0]=n=>t.$router.push({name:"Chat",params:{groupId:t.$route.params.groupId}})),"left-arrow":"",fixed:"",placeholder:"","safe-area-inset-top":"","z-index":"2",title:t.$t("groupDetails")},V({_:2},[e.groupInfo.currentUser.role==1||e.groupInfo.currentUser.role==2?{name:"right",fn:g(()=>[e.groupInfo.currentUser.role==1||e.groupInfo.currentUser.role==2?(a(),p(f,{key:0,class:"icon",size:"1.6em",name:"/assets/images/edit.png",onClick:e.editGroup},null,8,["onClick"])):l("",!0)])}:void 0]),1032,["title"])]),r("div",null,[r("div",F,[r("div",J,[e.groupInfo.groupId?(a(),p(C,{key:0,class:"avatar",image:e.groupInfo.image?e.groupInfo.image:t.$f.formatIcon(t.$route.params.groupId),address:e.groupInfo.address},null,8,["image","address"])):l("",!0),r("div",E,[r("span",null,m(t.$f.getGroupShowName({address:e.groupInfo.groupId.split("-")[0],name:e.groupInfo.name,nickname:e.groupInfo.nickname})),1),e.groupInfo.providers.length>0?(a(),i("div",O,[s(h,{class:"img","lazy-load":"",src:"/assets/images/certification.png"})])):l("",!0),e.groupInfo.type=="nft"?(a(),i("div",R,[s(h,{class:"img","lazy-load":"",src:"/assets/images/NFT.png"})])):l("",!0)]),r("div",W,m(e.groupInfo.totalMembers)+" \u6210\u5458 ",1)]),r("div",q,[s(c,{title:"Token\u540D\u79F0\uFF1A",border:!1,value:e.groupInfo.name},null,8,["value"]),s(c,{title:"\u94FE\u540D\u79F0\uFF1A",border:!1},{value:g(()=>[r("div",H,[e.groupInfo.chain?(a(),p(f,{key:0,class:"chain-icon",name:`https://ave.s3.ap-east-1.amazonaws.com/chain/${e.groupInfo.chain}.png`},null,8,["name"])):l("",!0),r("span",null,m(e.groupInfo.chain),1)])]),_:1}),s(c,{title:"\u5B98\u65B9\u7F51\u7AD9\uFF1A",border:!1,value:e.groupInfo.officialWebsiteUrl},null,8,["value"]),s(c,{title:"\u7B80\u4ECB\uFF1A",border:!1,value:e.groupInfo.description||""},null,8,["value"])]),e.groupInfo.isJoined?(a(),i("div",K,[s(_,{class:"share-btn btn",round:"",block:"","native-type":"submit",type:"default",onClick:e.shareLink},{default:g(()=>[P]),_:1},8,["onClick"]),b(s(_,{class:"admin-btn btn",round:"",block:"","native-type":"submit",onClick:e.openBecomeManager,type:"primary"},{default:g(()=>[Q]),_:1},8,["onClick"]),[[k,e.groupInfo.managers.length<5&&e.groupInfo.currentUser.role==0]])])):l("",!0)]),e.groupInfo.isJoined?(a(),i("div",X,[s(c,{title:"\u7FA4\u8FDD\u89C4\u5904\u7406","is-link":"","value-class":e.groupInfo.status==2||e.groupInfo.status==3?"active":"",value:e.groupInfo.status==2||e.groupInfo.status==3?"\u6709\u5904\u7F5A\uFF0C\u53BB\u5904\u7406":"\u65E0\u5904\u7F5A",onClick:e.jumpToViolation},null,8,["value-class","value","onClick"])])):l("",!0),e.groupInfo.isJoined?(a(),i("div",Y,[e.groupInfo.providers.length==0||e.groupInfo.currentUser.role==2?(a(),p(c,{key:0,"is-link":"",onClick:e.jumpToEditOfficial},{title:g(()=>[r("div",Z,[$,r("div",ee,[s(h,{class:"img","lazy-load":"",src:"/assets/images/certification.png"})])])]),_:1},8,["onClick"])):l("",!0)])):l("",!0),r("div",te,[s(c,{title:"\u7FA4\u6210\u5458("+e.groupInfo.totalMembers+")",border:!1},{"right-icon":g(()=>[r("span",{onClick:o[1]||(o[1]=(...n)=>e.jumpToBanned&&e.jumpToBanned(...n))},[oe,s(f,{name:"arrow",class:"arrow-icon"})])]),_:1},8,["title"]),r("div",re,[s(B,{loading:u.loading,"onUpdate:loading":o[2]||(o[2]=n=>u.loading=n),offset:"100","loading-text":t.$t("loading"),finished:u.finished,"finished-text":t.$t("noMore"),error:u.error,"onUpdate:error":o[3]||(o[3]=n=>u.error=n),"error-text":t.$t("errorText"),onLoad:e.getMemberList,"immediate-check":!1},{default:g(()=>[(a(!0),i(j,null,S(u.groupMemberList,(n,ge)=>(a(),p(L,{groupMemberItem:n,role:t.$store.state.user.role,userRole:t.$store.state.user.role},null,8,["groupMemberItem","role","userRole"]))),256)),b(s(w,{class:"empty",description:t.$t("emptyData")},null,8,["description"]),[[k,u.groupMemberList&&u.groupMemberList.length===0&&!u.loading]])]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text","onLoad"])])]),e.groupInfo.isJoined?(a(),i("div",se,[t.$store.state.user.role==2||t.$store.state.user.role==3?(a(),i("div",ae,[r("div",{class:"weigui",onClick:o[4]||(o[4]=(...n)=>e.jumpAddViolation&&e.jumpAddViolation(...n))},ie),r("div",{class:"out",onClick:o[5]||(o[5]=(...n)=>e.leaveGroup&&e.leaveGroup(...n))},[r("div",null,m(t.$t("exitChat")),1)])])):(a(),i("div",le,[r("div",{class:"out",onClick:o[6]||(o[6]=(...n)=>e.leaveGroup&&e.leaveGroup(...n))},m(t.$t("exitChat")),1)]))])):l("",!0)])])}const ve=T(U,[["render",ue],["__scopeId","data-v-e804fcaf"]]);export{ve as default};
