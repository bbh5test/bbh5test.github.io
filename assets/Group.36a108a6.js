import{_ as w,c as I,a as L,b as T,B as $,d as B,s as N,e as D,o,f as d,w as h,g as n,t as k,h as l,i as s,j as p,k as f,r as c,p as C,l as x,F as M,m as P,K as U}from"./index.7f34ccfb.js";import{D as j}from"./dialogBase.b2426d80.js";const F={name:"BlablaPay",inject:["reload"],components:{DialogBase:j},data(){return{contractAddress:"0x1BEcc0D044267540e81C1d203Eb7875ED9ff120F",jfTokenAddress:"0xaf22F677373352761B7F8FAfF4c9aD7bd8B6Be42",tradeHash:"N/A",tradeStatus:void 0,payWay:0,unUsedNum:0,tokenId:"0",isShowApprove:!1,isShowButton:!1,isConfirmLoading:!1,isApproveLoading:!1}},watch:{"$store.state.group.tradeVisable"(e){e&&this.init()}},computed:{tradeVisable:{get(){return this.$store.state.group.tradeVisable},set(e){this.$store.commit("setTradeVisable",e),this.tradeStatus==2&&this.reload()}},paymentType(){return this.$store.state.group.paymentType}},mounted(){},methods:{copy:I,async init(){if(this.tradeHash="N/A",this.tradeStatus=void 0,this.payWay=0,this.unUsedNum=0,this.tokenId="0",this.isShowApprove=!1,this.isShowButton=!1,this.isConfirmLoading=!1,this.isApproveLoading=!1,!await this.$store.dispatch("getPaymentListAction"))this.payWay=2;else{let a=this.$store.state.user.paymentList;if(a.length==0)this.payWay=2;else{let r=0;for(let m of a)this.paymentType==0?m.status==0&&m.paymentType==0&&(r=r+1):this.paymentType==1&&m.status==0&&m.paymentType==1&&(r=r+1);r>0?(this.payWay=1,this.unUsedNum=r):this.payWay=2}}this.isShowButton=!0},async changeTokenId(){this.tokenId==0&&(this.isShowButton=!0,this.isShowApprove=!1)},async payConfirm(){if(this.isConfirmLoading=!0,this.tokenId==1&&!await L({spender:this.contractAddress,tokenAddress:this.jfTokenAddress,account:this.$store.state.user.userAddress})){this.isShowButton=!1,this.isShowApprove=!0,this.$toast("\u8BF7\u5148\u6388\u6743"),this.isConfirmLoading=!1;return}if(this.payWay==1){let e=await this.trade();if(e=="fail")this.$toast.fail("\u652F\u4ED8\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u652F\u4ED8");else if(e=="success"){let a;this.paymentType==0?a="\u8D2D\u4E70\u7BA1\u7406\u5458\u6210\u529F":this.paymentType==1&&(a="\u8FDD\u89C4\u5904\u7F5A\u652F\u4ED8\u6210\u529F"),this.$toast.success(a),this.$store.commit("setTradeVisable",!1)}}else{if(console.log(await T()),!await T()){console.log("\u6821\u9A8C\u7F51\u7EDC\u548C\u8D26\u6237\u51FA\u9519"),this.$store.commit("logout"),this.$store.commit("setUserInfo",{}),this.$store.commit("setTradeVisable",!1),this.$store.dispatch("checkLogin"),this.isConfirmLoading=!1;return}this.tradeStatus=0,this.isShowButton=!1;try{let e=await $(this.contractAddress,this.paymentType,parseInt(this.tokenId));e&&(console.log(e),this.tradeHash=e.hash,this.tradeStatus=1,await this.timeCheckTrade())}catch{this.tradeStatus=-1}}this.isConfirmLoading=!1},async trade(){try{if(this.paymentType==0){if((await B.groupMember.buyManager(this.$store.state.group.groupId)).status==1)return await this.$store.dispatch("getGroupDetail",this.$route.params.groupId),this.$store.commit("setCurrentUserRole",1),"success"}else if(this.paymentType==1&&(await B.groupViolation.dealWithViolation(this.$store.state.group.groupId)).status==1)return this.$store.commit("setGroupStatus",0),this.$router.push({name:"GroupDetail",params:{groupId:this.$route.params.groupId}}),"success"}catch(e){console.log(e)}return"fail"},async timeCheckTrade(){console.log("timeCheckTrade");let e=!1,a=setTimeout(async function(){e=!0},6e4);for(;;){try{if(await this.trade()=="success"){this.tradeStatus=2,clearTimeout(a);break}}catch(r){console.log(r)}if(e){this.tradeStatus=-2;break}await N(3e3)}},async approve(){this.isApproveLoading=!0;try{let e=await D(this.contractAddress,this.jfTokenAddress);e&&(this.isShowApprove=!1,this.isShowButton=!0),console.log(e)}catch(e){console.log(e)}finally{this.isApproveLoading=!1}},jumpToTxDetail(){window.open("https://rinkeby.etherscan.io/tx/"+this.tradeHash,"_blank")},jumpToPaymentList(){this.$store.commit("setTradeVisable",!1),this.$router.push({name:"PaymentList"})}}},A=e=>(C("data-v-d8d8282b"),e=e(),x(),e),W={key:0,class:"pay-way"},z={key:1,class:"has-unused"},H={key:0},G={key:1},E={key:2,class:"no-unused"},O={key:0},R={key:1},K=f("\u652F\u4ED8 1 BNB"),q=f("\u652F\u4ED8 200 JF"),J=f("approve"),Q={key:1,class:"status-content"},X={class:"status-text"},Y={key:0},Z={key:1},ee={key:2},te={key:3},se={class:"status-icon"},oe={class:"trade-hash"},ae=f(" \u4EA4\u6613Hash\uFF1A "),ie={key:0},ne=A(()=>s("use",{"xlink:href":"#icon-copy"},null,-1)),re=[ne],ce={key:1},le=A(()=>s("span",null,"N/A",-1)),de=[le];function pe(e,a,r,m,t,i){const _=c("van-loading"),v=c("van-radio"),b=c("van-radio-group"),y=c("van-button"),S=c("van-icon"),V=c("DialogBase");return o(),d(V,{class:"trade-box",autoClose:!1,clickOverlayIsClose:!1,visible:i.tradeVisable,"onUpdate:visible":a[4]||(a[4]=u=>i.tradeVisable=u),title:typeof t.tradeStatus!="number"?"\u63D0\u793A":"\u4EA4\u6613\u8BE6\u60C5",showConfirmButton:t.isShowButton,showCancelButton:t.isShowButton,onOnConfirm:i.payConfirm,confirmLoading:t.isConfirmLoading},{default:h(()=>[typeof t.tradeStatus!="number"?(o(),n("div",W,[t.payWay==0?(o(),d(_,{key:0,type:"spinner",size:"48px"})):t.payWay==1?(o(),n("div",z,[i.paymentType==1?(o(),n("span",H," \u4F60\u6709"+k(t.unUsedNum)+"\u6B21\u672A\u4F7F\u7528\u7684\u652F\u4ED8\u8BB0\u5F55\u53EF\u7528\u4E8E\u8FDD\u89C4\u5904\u7F5A\uFF0C\u4E00\u65E6\u4F60\u5904\u7406\u4E86\u8FD9\u6B21\u8FDD\u89C4\uFF0C\u5C31\u4F1A\u4F7F\u7528\u4E00\u6761\u652F\u4ED8\u8BB0\u5F55\u3002 ",1)):i.paymentType==0?(o(),n("span",G," \u4F60\u6709"+k(t.unUsedNum)+"\u6B21\u672A\u4F7F\u7528\u7684\u652F\u4ED8\u8BB0\u5F55\u53EF\u7528\u4E8E\u7BA1\u7406\u5458\u8D2D\u4E70\uFF0C\u4E00\u65E6\u4F60\u8D2D\u4E70\u4E86\u7BA1\u7406\u5458\uFF0C\u5C31\u4F1A\u4F7F\u7528\u4E00\u6761\u652F\u4ED8\u8BB0\u5F55\u3002 ",1)):l("",!0)])):t.payWay==2?(o(),n("div",E,[s("label",null,[i.paymentType==1?(o(),n("span",O,"\u9009\u62E9\u4E00\u79CD\u65B9\u5F0F\u652F\u4ED8\u8FDD\u89C4\u5904\u7F5A")):i.paymentType==0?(o(),n("span",R,"\u9009\u62E9\u4E00\u79CD\u65B9\u5F0F\u8D2D\u4E70\u7BA1\u7406\u5458")):l("",!0)]),p(b,{modelValue:t.tokenId,"onUpdate:modelValue":a[0]||(a[0]=u=>t.tokenId=u),onChange:i.changeTokenId},{default:h(()=>[p(v,{class:"radio-item","checked-color":"#9505F9","icon-size":"16px",name:"0"},{default:h(()=>[K]),_:1}),p(v,{class:"radio-item","checked-color":"#9505F9","icon-size":"16px",name:"1"},{default:h(()=>[q]),_:1})]),_:1},8,["modelValue","onChange"])])):l("",!0),t.isShowApprove?(o(),d(y,{key:3,class:"approve",round:"",type:"primary",onClick:i.approve,loading:t.isApproveLoading},{default:h(()=>[J]),_:1},8,["onClick","loading"])):l("",!0)])):(o(),n("div",Q,[s("div",X,[t.tradeStatus==0?(o(),n("span",Y,"\u53D1\u9001\u4EA4\u6613\u5230\u533A\u5757\u94FE...")):t.tradeStatus==1?(o(),n("span",Z,"\u7B49\u5F85\u670D\u52A1\u5668\u540C\u6B65...")):t.tradeStatus==-1?(o(),n("span",ee,"\u4E0A\u94FE\u4EA4\u6613\u53D1\u9001\u5931\u8D25")):t.tradeStatus==-2?(o(),n("span",te,"\u670D\u52A1\u5668\u540C\u6B65\u8D85\u65F6")):l("",!0)]),s("div",se,[t.tradeStatus==0||t.tradeStatus==1?(o(),d(_,{key:0,type:"spinner",size:"48px"})):l("",!0),t.tradeStatus==2?(o(),d(S,{key:1,color:"#07c160",size:"40px",name:"checked"})):l("",!0),t.tradeStatus==-1||t.tradeStatus==-2?(o(),d(S,{key:2,color:"#FA5151",size:"40px",name:"clear"})):l("",!0)]),s("div",oe,[ae,t.tradeStatus==1||t.tradeStatus==2||t.tradeStatus==-2?(o(),n("text",ie,[s("span",{onClick:a[1]||(a[1]=(...u)=>i.jumpToTxDetail&&i.jumpToTxDetail(...u))},k(e.$f.formatAddress(t.tradeHash,6)),1),(o(),n("svg",{class:"icon-svg icon-renzheng","aria-hidden":"true",onClick:a[2]||(a[2]=u=>i.copy(t.tradeHash))},re))])):t.tradeStatus==0||t.tradeStatus==-1?(o(),n("text",ce,de)):l("",!0)]),t.tradeStatus==2||t.tradeStatus==-2?(o(),n("div",{key:0,class:"check-trade-list",onClick:a[3]||(a[3]=(...u)=>i.jumpToPaymentList&&i.jumpToPaymentList(...u))}," \u67E5\u770B\u652F\u4ED8\u8BB0\u5F55 ")):l("",!0)]))]),_:1},8,["visible","title","showConfirmButton","showCancelButton","onOnConfirm","confirmLoading"])}const ue=w(F,[["render",pe],["__scopeId","data-v-d8d8282b"]]);const he={name:"BecomeManager",props:{visible:Boolean},components:{},data(){return{}},computed:{dialogVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}}},watch:{},methods:{becomeManager(){this.$store.commit("setTradeVisable",!0),this.$store.commit("setPaymentType",0),this.dialogVisible=!1}},created(){},mounted(){}},g=e=>(C("data-v-db27ec0e"),e=e(),x(),e),me=g(()=>s("h3",{class:"title"}," \u6210\u4E3A\u7BA1\u7406\u5458 ",-1)),_e={class:"content"},ye=g(()=>s("div",{class:"info"},[f("\u7BA1\u7406\u5458\u5E2D\u4F4D\u8FD8\u6709"),s("span",null,"5"),f("\u4E2A\uFF0C\u4F60\u53EF\u4EE5\u6210\u4E3A\u6B64Token\u7FA4\u7684\u7BA1\u7406\u5458")],-1)),fe={class:"privilege"},ge=g(()=>s("div",{class:"privilege-info"},"\u6210\u4E3A\u7BA1\u7406\u5458\u540E\uFF0C\u60A8\u5C06\u62E5\u6709\u4EE5\u4E0B\u7279\u6743\uFF1A",-1)),ve={class:"privilege-list"},be=g(()=>s("div",{class:"item"},[s("div",{class:"img"},[s("i",{class:"iconfont icon-kick"})]),s("div",{class:"text"}," \u7981\u8A00\u6216\u8E22\u51FA ")],-1)),ke=g(()=>s("div",{class:"item"},[s("div",{class:"img"},[s("i",{class:"iconfont icon-zhiding"})]),s("div",{class:"text"}," \u7F6E\u9876\u6D88\u606F ")],-1)),we={class:"item"},Se={class:"img"},Te=g(()=>s("div",{class:"text"}," \u7BA1\u7406\u7FA4\u7EC4 ",-1)),Be={class:"item"},Ce={class:"img"},xe=g(()=>s("div",{class:"text"}," \u66F4\u591A\u7279\u6743 ",-1)),Ae={class:"action-bar"},Ve=f("\u786E\u5B9A ");function Ie(e,a,r,m,t,i){const _=c("van-icon"),v=c("van-button"),b=c("van-popup");return o(),d(b,{show:i.dialogVisible,"onUpdate:show":a[0]||(a[0]=y=>i.dialogVisible=y),closeable:!0,round:"",position:"center",teleport:"#app",class:"become-manager"},{default:h(()=>[me,s("div",_e,[ye,s("div",fe,[ge,s("div",ve,[be,ke,s("div",we,[s("div",Se,[p(_,{class:"icon-svg",size:"1.3em",name:"/assets/images/set.png"})]),Te]),s("div",Be,[s("div",Ce,[p(_,{class:"icon-svg",size:"1.3em",name:"/assets/images/tequan.png"})]),xe])])])]),s("div",Ae,[p(v,{type:"primary",class:"btn",onClick:i.becomeManager},{default:h(()=>[Ve]),_:1},8,["onClick"])])]),_:1},8,["show"])}const Le=w(he,[["render",Ie],["__scopeId","data-v-db27ec0e"]]),$e={name:"Group",components:{BlablaPay:ue,BecomeManager:Le},computed:{becomeManagerVisible:{get(){return this.$store.state.group.becomeManagerVisible},set(e){this.$store.commit("setBecomeManagerVisible",e)}}},mounted(){console.log(this.$route.params.groupId)}};function Ne(e,a,r,m,t,i){const _=c("router-view"),v=c("become-manager"),b=c("BlablaPay");return o(),n(M,null,[p(_,null,{default:h(({Component:y})=>[(o(),d(U,null,[(o(),d(P(y)))],1024))]),_:1}),p(v,{visible:i.becomeManagerVisible,"onUpdate:visible":a[0]||(a[0]=y=>i.becomeManagerVisible=y)},null,8,["visible"]),p(b)],64)}const Pe=w($e,[["render",Ne]]);export{Pe as default};
