import{_ as w,k as f,d as u,b as a,m as i,f as N,t as h,w as g,r,o as l,F as M,x as $,u as I,v as S,a as _,e as p}from"./index.d84cb8d1.js";import{A as V}from"./avatar.f678cd50.js";const A={name:"Chats",components:{Avatar:V},data(){return{refreshing:!1,loading:!1,error:!1,finished:!1,chatList:[],pageSize:10,pageNumber:1}},methods:{getGroupTitle(e){return this.$f.getGroupShowName({address:e.groupId.split("-")[0],name:e.name,nickname:e.nickname})},showUnreadMsgCount(e){return e>99?"99+":e},async onNextPage(){console.log("onNextPage"),this.pageNumber++,await this.getChatList()},async onRefresh(){this.pageNumber=1,this.chatList=[],await this.getChatList(),this.refreshing=!1},linkToSearch(){this.$router.push("/search")},async getChatList(){this.loading=!0;let e=[];for(let t of Object.keys(this.$store.state.group.msgTimeList)){let d=t.split("_")[0],c=t.split("_")[1];d==this.$store.state.user.userAddress&&e.push({groupId:c,time:this.$store.state.group.msgTimeList[t]})}try{let t=await f.group.getMyGroups(this.pageSize,this.pageNumber,e);if(t.status==1){t.data.total<=this.pageSize*this.pageNumber?this.finished=!0:this.finished=!1;for(let c of t.data.groups)this.chatList.push(c)}else this.error=!0}catch{this.error=!0}this.loading=!1},formatTimestamp(e){let t=this.$dayjs.unix(e);return t.isToday()?t.format("HH:mm"):t.isYesterday()?this.$t("yesterday")+" "+t.format("HH:mm"):t.format("YYYY-MM-DD HH:mm")},async exitChat(e){(await f.group.leave(e)).status==1&&(this.chatList=this.chatList.filter(d=>d.groupId!=e))},toChat(e){this.$router.push("/group/"+e+"/chat")}},mounted(){this.getChatList()}},H={class:"myChats-container"},z={class:"chat-content"},D={class:"search-bar"},R={class:"chats-container"},U=["onClick"],Y={class:"avatar"},B={class:"content"},G={class:"left"},P={class:"title"},j={class:"desc"},F={class:"info"},q={key:0,class:"time"},E={key:1,class:"unread"};function O(e,t,d,c,o,n){const v=r("van-nav-bar"),m=r("van-icon"),C=r("Avatar"),y=r("van-button"),k=r("van-swipe-cell"),x=r("van-empty"),b=r("van-list"),L=r("van-pull-refresh");return l(),u("section",H,[a("div",null,[i(v,{fixed:"","safe-area-inset-top":"","z-index":"2",title:e.$t("chats")},null,8,["title"])]),a("div",z,[a("div",D,[a("div",{class:"search",onClick:t[0]||(t[0]=(...s)=>n.linkToSearch&&n.linkToSearch(...s))},[i(m,{name:"search"}),N(" \xA0"+h(e.$t("search")),1)])]),a("div",R,[i(L,{modelValue:o.refreshing,"onUpdate:modelValue":t[3]||(t[3]=s=>o.refreshing=s),"pulling-text":e.$t("pulling"),"loosing-text":e.$t("loosing"),"loading-text":e.$t("loading"),onRefresh:n.onRefresh},{default:g(()=>[i(b,{"loading-text":e.$t("loading"),loading:o.loading,"onUpdate:loading":t[1]||(t[1]=s=>o.loading=s),finished:o.finished,"finished-text":e.$t("noMore"),error:o.error,"onUpdate:error":t[2]||(t[2]=s=>o.error=s),"error-text":e.$t("errorText"),onLoad:n.onNextPage,"immediate-check":!1},{default:g(()=>[(l(!0),u(M,null,$(o.chatList,s=>(l(),_(k,{key:s.groupId,class:"chat-item-cell"},{right:g(()=>[i(y,{class:"exit-chat",square:"",type:"danger",text:e.$t("exitChat"),onClick:T=>n.exitChat(s.groupId)},null,8,["text","onClick"])]),default:g(()=>[a("div",{class:"chat-item",onClick:T=>n.toChat(s.groupId)},[a("div",Y,[i(C,{class:"avatar",image:s.image?s.image:e.$f.formatIcon(s.groupId),address:s.groupId.split("-")[0]},null,8,["image","address"])]),a("div",B,[a("div",null,[a("div",G,[a("div",P,h(n.getGroupTitle(s)),1),s.providerCount>0?(l(),_(m,{key:0,class:"cert",size:"0.4rem",name:"/assets/images/certification.png"})):p("",!0)]),a("div",j,h(`${s.totalMembers}
                                                                                    ${e.$t("members")}, ${s.onlineMembers} ${e.$t("online")}`),1)]),a("div",F,[s.lastChatTime?(l(),u("div",q,h(n.formatTimestamp(s.lastChatTime)),1)):p("",!0),s.unreadMsgCount?(l(),u("div",E,[a("span",null,h(n.showUnreadMsgCount(s.unreadMsgCount)),1)])):p("",!0)])])],8,U)]),_:2},1024))),128)),I(i(x,{class:"empty",description:e.$t("emptyData")},null,8,["description"]),[[S,o.chatList&&o.chatList.length===0&&!o.loading]])]),_:1},8,["loading-text","loading","finished","finished-text","error","error-text","onLoad"])]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text","onRefresh"])])])])}const Q=w(A,[["render",O],["__scopeId","data-v-b711e829"]]);export{Q as default};
