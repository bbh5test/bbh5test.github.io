import{_ as N,d as p,g as h,i as a,j as r,w as u,k as b,r as o,o as c,F as w,x as T,f,t as l,h as _}from"./index.c378eab7.js";import{A as S}from"./avatar.57947a22.js";const I={name:"Chats",components:{Avatar:S},data(){return{refreshing:!1,loading:!1,finished:!1,chatList:[],pageSize:10,pageNumber:1}},methods:{getGroupTitle(t){return this.$f.getGroupShowName({address:t.groupId.split("-")[0],name:t.name,nickname:t.nickname})},showUnreadmsgCount(t){return t>99?"99+":t},async onNextPage(){console.log("onNextPage"),this.pageNumber++,await this.getChatList()},async onRefresh(){this.pageNumber=1,this.chatList=[],await this.getChatList(),this.refreshing=!1},linkToSearch(){this.$router.push("/search")},async getChatList(){let t=await p.group.getMyGroups(this.pageSize,this.pageNumber);if(t.status==1){this.loading=!1,t.data.total<=this.pageSize*this.pageNumber?this.finished=!0:this.finished=!1;for(let d of t.data.groups)this.chatList.push(d)}},formatTimestamp(t){let s=this.$dayjs.unix(t);return s.isToday()?s.format("HH:mm"):s.isYesterday()?this.$t("yesterday")+" "+s.format("HH:mm"):s.format("YYYY-MM-DD HH:mm")},async exitChat(t){(await p.group.leave(t)).status==1&&(this.chatList=this.chatList.filter(d=>d.groupId!=t))},toChat(t){this.$router.push("/group/"+t+"/chat")}},mounted(){this.getChatList()}},V={class:"myChats-container"},z={class:"chat-content"},H={class:"search-bar"},M=b(" \xA0\u641C\u7D22 "),Y={class:"chats-container"},A=["onClick"],B={class:"avatar"},G={class:"content"},R={class:"left"},U={class:"title"},D={class:"desc"},P={class:"info"},j={key:0,class:"time"},F={key:1,class:"unread"};function q(t,s,d,E,i,n){const m=o("van-nav-bar"),g=o("van-icon"),v=o("Avatar"),C=o("van-button"),k=o("van-swipe-cell"),x=o("van-list"),y=o("van-pull-refresh");return c(),h("section",V,[a("div",null,[r(m,{fixed:"",placeholder:"","safe-area-inset-top":"","z-index":"2",title:"Chats"})]),a("div",z,[a("div",H,[a("div",{class:"search",onClick:s[0]||(s[0]=(...e)=>n.linkToSearch&&n.linkToSearch(...e))},[r(g,{name:"search"}),M])]),a("div",Y,[r(y,{modelValue:i.refreshing,"onUpdate:modelValue":s[2]||(s[2]=e=>i.refreshing=e),onRefresh:n.onRefresh},{default:u(()=>[r(x,{"error-text":" \u8BF7\u6C42\u5931\u8D25\uFF0C\u70B9\u51FB\u91CD\u65B0\u52A0\u8F7D",loading:i.loading,"onUpdate:loading":s[1]||(s[1]=e=>i.loading=e),finished:i.finished,"finished-text":"\u6CA1\u6709\u66F4\u591A\u4E86",onLoad:n.onNextPage,"immediate-check":!1},{default:u(()=>[(c(!0),h(w,null,T(i.chatList,e=>(c(),f(k,{key:e.groupId,class:"chat-item-cell"},{right:u(()=>[r(C,{class:"exit-chat",square:"",type:"danger",text:"\u9000\u51FA\u7FA4\u804A",onClick:L=>n.exitChat(e.groupId)},null,8,["onClick"])]),default:u(()=>[a("div",{class:"chat-item",onClick:L=>n.toChat(e.groupId)},[a("div",B,[r(v,{class:"avatar",image:e.image?e.image:`https://ave.s3.ap-east-1.amazonaws.com/chain/${e.groupId.split("-")[1]}.png`,address:e.groupId.split("-")[0]},null,8,["image","address"])]),a("div",G,[a("div",null,[a("div",R,[a("div",U,l(n.getGroupTitle(e)),1),e.providerCount>0?(c(),f(g,{key:0,class:"cert",size:"0.4rem",name:"/assets/images/certification.png"})):_("",!0)]),a("div",D,l(e.totalMembers)+"\u4EBA,\xA0"+l(e.onlineMembers)+"\u5728\u7EBF ",1)]),a("div",P,[e.lastchated?(c(),h("div",j,l(n.formatTimestamp(e.lastchated)),1)):_("",!0),e.unreadmsgCount?(c(),h("div",F,[a("span",null,l(n.showUnreadmsgCount(e.unreadmsgCount)),1)])):_("",!0)])])],8,A)]),_:2},1024))),128))]),_:1},8,["loading","finished","onLoad"])]),_:1},8,["modelValue","onRefresh"])])])])}const O=N(I,[["render",q],["__scopeId","data-v-03414ddf"]]);export{O as default};
