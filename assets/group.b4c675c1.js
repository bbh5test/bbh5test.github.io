import{_ as w,c as V,a as I,b as L,d as $,B as N,e as T,s as D,f as M,o as a,g as m,w as _,h as n,t as k,i as l,j as o,k as d,l as y,r as c,p as B,m as C,F as P}from"./index.84cb370a.js";import{D as U}from"./dialogBase.fc931ad6.js";const j={name:"BlablaPay",inject:["reload"],components:{DialogBase:U},data(){return{contractAddress:"0x1BEcc0D044267540e81C1d203Eb7875ED9ff120F",jfTokenAddress:"0xaf22F677373352761B7F8FAfF4c9aD7bd8B6Be42",tradeHash:"N/A",tradeStatus:void 0,payWay:0,unUsedNum:0,tokenId:"0",isShowApprove:!1,isShowButton:!1,isConfirmLoading:!1,isApproveLoading:!1}},watch:{"$store.state.group.tradeVisable"(e){e&&this.init()}},computed:{tradeVisable:{get(){return this.$store.state.group.tradeVisable},set(e){this.$store.commit("setTradeVisable",e),this.tradeStatus==2&&this.reload()}},paymentType(){return this.$store.state.group.paymentType}},mounted(){},methods:{copy:V,async init(){if(this.tradeHash="N/A",this.tradeStatus=void 0,this.payWay=0,this.unUsedNum=0,this.tokenId="0",this.isShowApprove=!1,this.isShowButton=!1,this.isConfirmLoading=!1,this.isApproveLoading=!1,!await this.$store.dispatch("getPaymentListAction"))this.payWay=2;else{let s=this.$store.state.user.paymentList;if(s.length==0)this.payWay=2;else{let r=0;for(let p of s)this.paymentType==0?p.status==0&&p.paymentType==0&&(r=r+1):this.paymentType==1&&p.status==0&&p.paymentType==1&&(r=r+1);r>0?(this.payWay=1,this.unUsedNum=r):this.payWay=2}}this.isShowButton=!0},async changeTokenId(){this.tokenId==0&&(this.isShowButton=!0,this.isShowApprove=!1)},async payConfirm(){if(this.isConfirmLoading=!0,this.payWay==1){let e=await this.trade();if(e=="fail")this.$toast.fail("\u652F\u4ED8\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u652F\u4ED8");else if(e=="success"){let s;this.paymentType==0?s="\u8D2D\u4E70\u7BA1\u7406\u5458\u6210\u529F":this.paymentType==1&&(s="\u8FDD\u89C4\u5904\u7F5A\u652F\u4ED8\u6210\u529F"),this.$toast.success(s),this.$store.commit("setTradeVisable",!1)}}else{console.log("\u6821\u9A8C\u7F51\u7EDC\u548C\u8D26\u6237");let e=await I();if(e=="netErr"){await L(),this.isConfirmLoading=!1;return}else if(e=="tokenErr"){this.$toast({duration:3e3,message:"\u8BF7\u5C06\u94B1\u5305\u8D26\u6237\u5207\u6362\u5230\u767B\u5F55\u7528\u6237"}),this.isConfirmLoading=!1;return}else if(e==!1){console.log("\u6CA1\u6709\u767B\u5F55\u6216\u8005\u83B7\u53D6\u8D26\u6237\u51FA\u9519\uFF0C\u91CD\u65B0\u767B\u5F55"),this.$store.commit("logout"),this.$store.commit("setUserInfo",{}),this.$store.commit("setTradeVisable",!1),this.$store.dispatch("checkLogin"),this.isConfirmLoading=!1;return}if(this.tokenId==1&&!await $({spender:this.contractAddress,tokenAddress:this.jfTokenAddress,account:this.$store.state.user.userAddress})){this.isShowButton=!1,this.isShowApprove=!0,this.$toast("\u8BF7\u5148\u6388\u6743"),this.isConfirmLoading=!1;return}this.tradeStatus=0,this.isShowButton=!1;try{let s=await N(this.contractAddress,this.paymentType,parseInt(this.tokenId));s&&(console.log(s),this.tradeHash=s.hash,this.tradeStatus=1,await s.wait(),await this.timeCheckTrade())}catch(s){console.log(s),this.tradeStatus=-1}}this.isConfirmLoading=!1},async trade(){try{if(this.paymentType==0){if((await T.groupMember.buyManager(this.$store.state.group.groupId)).status==1)return await this.$store.dispatch("getGroupDetail",this.$route.params.groupId),this.$store.commit("setCurrentUserRole",1),"success"}else if(this.paymentType==1&&(await T.groupViolation.dealWithViolation(this.$store.state.group.groupId)).status==1)return this.$store.commit("setGroupStatus",0),this.$router.push({name:"GroupDetail",params:{groupId:this.$route.params.groupId}}),"success"}catch(e){console.log(e)}return"fail"},async timeCheckTrade(){console.log("timeCheckTrade");let e=!1,s=setTimeout(async function(){e=!0},6e4);for(;;){try{if(await this.trade()=="success"){this.tradeStatus=2,clearTimeout(s);break}}catch(r){console.log(r)}if(e){this.tradeStatus=-2;break}await D(3e3)}},async approve(){this.isApproveLoading=!0;try{let e=await M(this.contractAddress,this.jfTokenAddress);e&&(this.isShowApprove=!1,this.isShowButton=!0),console.log(e)}catch(e){console.log(e)}finally{this.isApproveLoading=!1}},jumpToTxDetail(){window.open("https://rinkeby.etherscan.io/tx/"+this.tradeHash,"_blank")},jumpToPaymentList(){this.$store.commit("setTradeVisable",!1),this.$router.push({name:"PaymentList"})}}},x=e=>(B("data-v-4a4c3ce2"),e=e(),C(),e),F={key:0,class:"pay-way"},W={key:1,class:"has-unused"},z={key:0},H={key:1},E={key:2,class:"no-unused"},G={key:0},O={key:1},R=y("\u652F\u4ED8 1 BNB"),q=y("\u652F\u4ED8 200 JF"),J=y("approve"),K={key:1,class:"status-content"},Q={class:"status-text"},X={key:0},Y={key:1},Z={key:2},ee={key:3},te={class:"status-icon"},se={class:"trade-hash"},oe=y(" \u4EA4\u6613Hash\uFF1A "),ae={key:0},ie=x(()=>o("use",{"xlink:href":"#icon-copy"},null,-1)),ne=[ie],re={key:1},ce=x(()=>o("span",null,"N/A",-1)),le=[ce];function de(e,s,r,p,t,i){const h=c("van-loading"),f=c("van-radio"),v=c("van-radio-group"),b=c("van-button"),S=c("van-icon"),A=c("DialogBase");return a(),m(A,{class:"trade-box",autoClose:!1,clickOverlayIsClose:!1,visible:i.tradeVisable,"onUpdate:visible":s[4]||(s[4]=u=>i.tradeVisable=u),title:typeof t.tradeStatus!="number"?"\u63D0\u793A":"\u4EA4\u6613\u8BE6\u60C5",showConfirmButton:t.isShowButton,showCancelButton:t.isShowButton,onOnConfirm:i.payConfirm,confirmLoading:t.isConfirmLoading},{default:_(()=>[typeof t.tradeStatus!="number"?(a(),n("div",F,[t.payWay==0?(a(),m(h,{key:0,type:"spinner",size:"48px"})):t.payWay==1?(a(),n("div",W,[i.paymentType==1?(a(),n("span",z," \u4F60\u6709"+k(t.unUsedNum)+"\u6B21\u672A\u4F7F\u7528\u7684\u652F\u4ED8\u8BB0\u5F55\u53EF\u7528\u4E8E\u8FDD\u89C4\u5904\u7F5A\uFF0C\u4E00\u65E6\u4F60\u5904\u7406\u4E86\u8FD9\u6B21\u8FDD\u89C4\uFF0C\u5C31\u4F1A\u4F7F\u7528\u4E00\u6761\u652F\u4ED8\u8BB0\u5F55\u3002 ",1)):i.paymentType==0?(a(),n("span",H," \u4F60\u6709"+k(t.unUsedNum)+"\u6B21\u672A\u4F7F\u7528\u7684\u652F\u4ED8\u8BB0\u5F55\u53EF\u7528\u4E8E\u7BA1\u7406\u5458\u8D2D\u4E70\uFF0C\u4E00\u65E6\u4F60\u8D2D\u4E70\u4E86\u7BA1\u7406\u5458\uFF0C\u5C31\u4F1A\u4F7F\u7528\u4E00\u6761\u652F\u4ED8\u8BB0\u5F55\u3002 ",1)):l("",!0)])):t.payWay==2?(a(),n("div",E,[o("label",null,[i.paymentType==1?(a(),n("span",G,"\u9009\u62E9\u4E00\u79CD\u65B9\u5F0F\u652F\u4ED8\u8FDD\u89C4\u5904\u7F5A")):i.paymentType==0?(a(),n("span",O,"\u9009\u62E9\u4E00\u79CD\u65B9\u5F0F\u8D2D\u4E70\u7BA1\u7406\u5458")):l("",!0)]),d(v,{modelValue:t.tokenId,"onUpdate:modelValue":s[0]||(s[0]=u=>t.tokenId=u),onChange:i.changeTokenId},{default:_(()=>[d(f,{class:"radio-item","checked-color":"#9505F9","icon-size":"16px",name:"0"},{default:_(()=>[R]),_:1}),d(f,{class:"radio-item","checked-color":"#9505F9","icon-size":"16px",name:"1"},{default:_(()=>[q]),_:1})]),_:1},8,["modelValue","onChange"])])):l("",!0),t.isShowApprove?(a(),m(b,{key:3,class:"approve",round:"",type:"primary",onClick:i.approve,loading:t.isApproveLoading},{default:_(()=>[J]),_:1},8,["onClick","loading"])):l("",!0)])):(a(),n("div",K,[o("div",Q,[t.tradeStatus==0?(a(),n("span",X,"\u53D1\u9001\u4EA4\u6613\u5230\u533A\u5757\u94FE...")):t.tradeStatus==1?(a(),n("span",Y,"\u7B49\u5F85\u670D\u52A1\u5668\u540C\u6B65...")):t.tradeStatus==-1?(a(),n("span",Z,"\u4E0A\u94FE\u4EA4\u6613\u53D1\u9001\u5931\u8D25")):t.tradeStatus==-2?(a(),n("span",ee,"\u670D\u52A1\u5668\u540C\u6B65\u8D85\u65F6")):l("",!0)]),o("div",te,[t.tradeStatus==0||t.tradeStatus==1?(a(),m(h,{key:0,type:"spinner",size:"48px"})):l("",!0),t.tradeStatus==2?(a(),m(S,{key:1,color:"#07c160",size:"40px",name:"checked"})):l("",!0),t.tradeStatus==-1||t.tradeStatus==-2?(a(),m(S,{key:2,color:"#FA5151",size:"40px",name:"clear"})):l("",!0)]),o("div",se,[oe,t.tradeStatus==1||t.tradeStatus==2||t.tradeStatus==-2?(a(),n("text",ae,[o("span",{onClick:s[1]||(s[1]=(...u)=>i.jumpToTxDetail&&i.jumpToTxDetail(...u))},k(e.$f.formatAddress(t.tradeHash,6)),1),(a(),n("svg",{class:"icon-svg icon-renzheng","aria-hidden":"true",onClick:s[2]||(s[2]=u=>i.copy(t.tradeHash))},ne))])):t.tradeStatus==0||t.tradeStatus==-1?(a(),n("text",re,le)):l("",!0)]),t.tradeStatus==2||t.tradeStatus==-2?(a(),n("div",{key:0,class:"check-trade-list",onClick:s[3]||(s[3]=(...u)=>i.jumpToPaymentList&&i.jumpToPaymentList(...u))}," \u67E5\u770B\u652F\u4ED8\u8BB0\u5F55 ")):l("",!0)]))]),_:1},8,["visible","title","showConfirmButton","showCancelButton","onOnConfirm","confirmLoading"])}const ue=w(j,[["render",de],["__scopeId","data-v-4a4c3ce2"]]);const pe={name:"BecomeManager",props:{visible:Boolean},components:{},data(){return{}},computed:{dialogVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}},managerSeat(){return 5-this.$store.state.group.managers.length}},watch:{},methods:{becomeManager(){this.$store.commit("setTradeVisable",!0),this.$store.commit("setPaymentType",0),this.dialogVisible=!1}},created(){},mounted(){}},g=e=>(B("data-v-4162bdf5"),e=e(),C(),e),he=g(()=>o("h3",{class:"title"}," \u6210\u4E3A\u7BA1\u7406\u5458 ",-1)),me={class:"content"},_e={class:"info"},ye=y("\u7BA1\u7406\u5458\u5E2D\u4F4D\u8FD8\u6709"),fe=y("\u4E2A\uFF0C\u4F60\u53EF\u4EE5\u6210\u4E3A\u6B64Token\u7FA4\u7684\u7BA1\u7406\u5458"),ge={class:"privilege"},ve=g(()=>o("div",{class:"privilege-info"},"\u6210\u4E3A\u7BA1\u7406\u5458\u540E\uFF0C\u60A8\u5C06\u62E5\u6709\u4EE5\u4E0B\u7279\u6743\uFF1A",-1)),be={class:"privilege-list"},ke=g(()=>o("div",{class:"item"},[o("div",{class:"img"},[o("i",{class:"iconfont icon-kick"})]),o("div",{class:"text"}," \u7981\u8A00\u6216\u8E22\u51FA ")],-1)),we=g(()=>o("div",{class:"item"},[o("div",{class:"img"},[o("i",{class:"iconfont icon-zhiding"})]),o("div",{class:"text"}," \u7F6E\u9876\u6D88\u606F ")],-1)),Se={class:"item"},Te={class:"img"},Be=g(()=>o("div",{class:"text"}," \u7BA1\u7406\u7FA4\u7EC4 ",-1)),Ce={class:"item"},xe={class:"img"},Ae=g(()=>o("div",{class:"text"}," \u66F4\u591A\u7279\u6743 ",-1)),Ve={class:"action-bar"};function Ie(e,s,r,p,t,i){const h=c("van-icon"),f=c("van-button"),v=c("van-popup");return a(),m(v,{show:i.dialogVisible,"onUpdate:show":s[0]||(s[0]=b=>i.dialogVisible=b),closeable:!0,round:"",position:"center",teleport:"#app",class:"become-manager"},{default:_(()=>[he,o("div",me,[o("div",_e,[ye,o("span",null,k(i.managerSeat),1),fe]),o("div",ge,[ve,o("div",be,[ke,we,o("div",Se,[o("div",Te,[d(h,{class:"icon-svg",size:"1.3em",name:"/assets/images/set.png"})]),Be]),o("div",Ce,[o("div",xe,[d(h,{class:"icon-svg",size:"1.3em",name:"/assets/images/tequan.png"})]),Ae])])])]),o("div",Ve,[d(f,{type:"primary",class:"btn",onClick:i.becomeManager},{default:_(()=>[y(k(e.$t("confirm")),1)]),_:1},8,["onClick"])])]),_:1},8,["show"])}const Le=w(pe,[["render",Ie],["__scopeId","data-v-4162bdf5"]]),$e={name:"Group",components:{BlablaPay:ue,BecomeManager:Le},computed:{becomeManagerVisible:{get(){return this.$store.state.group.becomeManagerVisible},set(e){this.$store.commit("setBecomeManagerVisible",e)}}},mounted(){console.log(this.$route.params.groupId)}};function Ne(e,s,r,p,t,i){const h=c("router-view"),f=c("become-manager"),v=c("BlablaPay");return a(),n(P,null,[d(h),d(f,{visible:i.becomeManagerVisible,"onUpdate:visible":s[0]||(s[0]=b=>i.becomeManagerVisible=b)},null,8,["visible"]),d(v)],64)}const Pe=w($e,[["render",Ne]]);export{Pe as default};
