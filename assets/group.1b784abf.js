import{_ as k,c as V,a as I,b as L,d as x,B as N,e as S,s as P,f as M,o as a,g as _,w as y,h as r,t as n,i as d,j as o,k as u,l as f,r as l,p as T,m as A,F as D}from"./index.c8b8f13a.js";import{D as F}from"./dialogBase.91be6fe9.js";const z={name:"BlablaPay",inject:["reload"],components:{DialogBase:F},data(){return{contractAddress:"0x1BEcc0D044267540e81C1d203Eb7875ED9ff120F",jfTokenAddress:"0xaf22F677373352761B7F8FAfF4c9aD7bd8B6Be42",tradeHash:"N/A",tradeStatus:void 0,payWay:0,unUsedNum:0,tokenId:"0",isShowApprove:!1,isShowButton:!1,isConfirmLoading:!1,isApproveLoading:!1}},watch:{"$store.state.group.tradeVisable"(e){e&&this.init()}},computed:{tradeVisable:{get(){return this.$store.state.group.tradeVisable},set(e){this.$store.commit("setTradeVisable",e),this.tradeStatus==2&&this.reload()}},paymentType(){return this.$store.state.group.paymentType}},mounted(){},methods:{copy:V,async init(){if(this.tradeHash="N/A",this.tradeStatus=void 0,this.payWay=0,this.unUsedNum=0,this.tokenId="0",this.isShowApprove=!1,this.isShowButton=!1,this.isConfirmLoading=!1,this.isApproveLoading=!1,!await this.$store.dispatch("getPaymentListAction"))this.payWay=2;else{let s=this.$store.state.user.paymentList;if(s.length==0)this.payWay=2;else{let c=0;for(let h of s)this.paymentType==0?h.status==0&&h.paymentType==0&&(c=c+1):this.paymentType==1&&h.status==0&&h.paymentType==1&&(c=c+1);c>0?(this.payWay=1,this.unUsedNum=c):this.payWay=2}}this.isShowButton=!0},async changeTokenId(){this.tokenId==0&&(this.isShowButton=!0,this.isShowApprove=!1)},async payConfirm(){if(this.isConfirmLoading=!0,this.payWay==1){let e=await this.trade();if(e=="fail")this.$toast.fail("\u652F\u4ED8\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u652F\u4ED8");else if(e=="success"){let s;this.paymentType==0?s="\u8D2D\u4E70\u7BA1\u7406\u5458\u6210\u529F":this.paymentType==1&&(s="\u8FDD\u89C4\u5904\u7F5A\u652F\u4ED8\u6210\u529F"),this.$toast.success(s),this.$store.commit("setTradeVisable",!1)}}else{console.log("\u6821\u9A8C\u7F51\u7EDC\u548C\u8D26\u6237");let e=await I();if(e=="netErr"){await L(),this.isConfirmLoading=!1;return}else if(e=="tokenErr"){this.$toast({duration:3e3,message:"\u8BF7\u5C06\u94B1\u5305\u8D26\u6237\u5207\u6362\u5230\u767B\u5F55\u7528\u6237"}),this.isConfirmLoading=!1;return}else if(e==!1){console.log("\u6CA1\u6709\u767B\u5F55\u6216\u8005\u83B7\u53D6\u8D26\u6237\u51FA\u9519\uFF0C\u91CD\u65B0\u767B\u5F55"),this.$store.commit("logout"),this.$store.commit("setUserInfo",{}),this.$store.commit("setTradeVisable",!1),this.$store.dispatch("checkLogin"),this.isConfirmLoading=!1;return}if(this.tokenId==1&&!await x({spender:this.contractAddress,tokenAddress:this.jfTokenAddress,account:this.$store.state.user.userAddress})){this.isShowButton=!1,this.isShowApprove=!0,this.$toast("\u8BF7\u5148\u6388\u6743"),this.isConfirmLoading=!1;return}this.tradeStatus=0,this.isShowButton=!1;try{let s=await N(this.contractAddress,this.paymentType,parseInt(this.tokenId));s&&(console.log(s),this.tradeHash=s.hash,this.tradeStatus=1,await s.wait(),await this.timeCheckTrade())}catch(s){console.log(s),this.tradeStatus=-1}}this.isConfirmLoading=!1},async trade(){try{if(this.paymentType==0){if((await S.groupMember.buyManager(this.$store.state.group.groupId)).status==1)return await this.$store.dispatch("getGroupDetail",this.$route.params.groupId),this.$store.commit("setCurrentUserRole",1),"success"}else if(this.paymentType==1&&(await S.groupViolation.dealWithViolation(this.$store.state.group.groupId)).status==1)return this.$store.commit("setGroupStatus",0),this.$router.push({name:"GroupDetail",params:{groupId:this.$route.params.groupId}}),"success"}catch(e){console.log(e)}return"fail"},async timeCheckTrade(){console.log("timeCheckTrade");let e=!1,s=setTimeout(async function(){e=!0},6e4);for(;;){try{if(await this.trade()=="success"){this.tradeStatus=2,clearTimeout(s);break}}catch(c){console.log(c)}if(e){this.tradeStatus=-2;break}await P(3e3)}},async approve(){this.isApproveLoading=!0;try{let e=await M(this.contractAddress,this.jfTokenAddress);e&&(this.isShowApprove=!1,this.isShowButton=!0),console.log(e)}catch(e){console.log(e)}finally{this.isApproveLoading=!1}},jumpToTxDetail(){window.open("https://rinkeby.etherscan.io/tx/"+this.tradeHash,"_blank")},jumpToPaymentList(){this.$store.commit("setTradeVisable",!1),this.$router.push({name:"PaymentList"})}}},B=e=>(T("data-v-18bc2934"),e=e(),A(),e),U={key:0,class:"pay-way"},j={key:1,class:"has-unused"},W={key:0},H={key:1},E={key:2,class:"no-unused"},R={key:0},G={key:1},O=f("\u652F\u4ED8 1 BNB"),q=f("\u652F\u4ED8 200 JF"),J=f("approve"),K={key:1,class:"status-content"},Q={class:"status-text"},X={key:0},Y={key:1},Z={key:2},ee={key:3},te={class:"status-icon"},se={class:"trade-hash"},oe={key:0},ae=B(()=>o("use",{"xlink:href":"#icon-copy"},null,-1)),ie=[ae],ne={key:1},re=B(()=>o("span",null,"N/A",-1)),ce=[re];function le(e,s,c,h,t,i){const m=l("van-loading"),g=l("van-radio"),v=l("van-radio-group"),b=l("van-button"),w=l("van-icon"),$=l("DialogBase");return a(),_($,{class:"trade-box",autoClose:!1,clickOverlayIsClose:!1,visible:i.tradeVisable,"onUpdate:visible":s[4]||(s[4]=p=>i.tradeVisable=p),title:typeof t.tradeStatus!="number"?"\u63D0\u793A":"\u4EA4\u6613\u8BE6\u60C5",showConfirmButton:t.isShowButton,showCancelButton:t.isShowButton,onOnConfirm:i.payConfirm,confirmLoading:t.isConfirmLoading},{default:y(()=>[typeof t.tradeStatus!="number"?(a(),r("div",U,[t.payWay==0?(a(),_(m,{key:0,type:"spinner",size:"48px"})):t.payWay==1?(a(),r("div",j,[i.paymentType==1?(a(),r("span",W," \u4F60\u6709"+n(t.unUsedNum)+"\u6B21\u672A\u4F7F\u7528\u7684\u652F\u4ED8\u8BB0\u5F55\u53EF\u7528\u4E8E\u8FDD\u89C4\u5904\u7F5A\uFF0C\u4E00\u65E6\u4F60\u5904\u7406\u4E86\u8FD9\u6B21\u8FDD\u89C4\uFF0C\u5C31\u4F1A\u4F7F\u7528\u4E00\u6761\u652F\u4ED8\u8BB0\u5F55\u3002 ",1)):i.paymentType==0?(a(),r("span",H," \u4F60\u6709"+n(t.unUsedNum)+"\u6B21\u672A\u4F7F\u7528\u7684\u652F\u4ED8\u8BB0\u5F55\u53EF\u7528\u4E8E\u7BA1\u7406\u5458\u8D2D\u4E70\uFF0C\u4E00\u65E6\u4F60\u8D2D\u4E70\u4E86\u7BA1\u7406\u5458\uFF0C\u5C31\u4F1A\u4F7F\u7528\u4E00\u6761\u652F\u4ED8\u8BB0\u5F55\u3002 ",1)):d("",!0)])):t.payWay==2?(a(),r("div",E,[o("label",null,[i.paymentType==1?(a(),r("span",R,"\u9009\u62E9\u4E00\u79CD\u65B9\u5F0F\u652F\u4ED8\u8FDD\u89C4\u5904\u7F5A")):i.paymentType==0?(a(),r("span",G,"\u9009\u62E9\u4E00\u79CD\u65B9\u5F0F\u8D2D\u4E70\u7BA1\u7406\u5458")):d("",!0)]),u(v,{modelValue:t.tokenId,"onUpdate:modelValue":s[0]||(s[0]=p=>t.tokenId=p),onChange:i.changeTokenId},{default:y(()=>[u(g,{class:"radio-item","checked-color":"#9505F9","icon-size":"16px",name:"0"},{default:y(()=>[O]),_:1}),u(g,{class:"radio-item","checked-color":"#9505F9","icon-size":"16px",name:"1"},{default:y(()=>[q]),_:1})]),_:1},8,["modelValue","onChange"])])):d("",!0),t.isShowApprove?(a(),_(b,{key:3,class:"approve",round:"",type:"primary",onClick:i.approve,loading:t.isApproveLoading},{default:y(()=>[J]),_:1},8,["onClick","loading"])):d("",!0)])):(a(),r("div",K,[o("div",Q,[t.tradeStatus==0?(a(),r("span",X,n(e.$t("sendingTransactionToBlockchain")),1)):t.tradeStatus==1?(a(),r("span",Y,n(e.$t("waitingForServiceSyncronizing")),1)):t.tradeStatus==-1?(a(),r("span",Z,n(e.$t("sendTransactionToBlockchainFailed")),1)):t.tradeStatus==-2?(a(),r("span",ee,n(e.$t("servicesyncronizingTimeout")),1)):d("",!0)]),o("div",te,[t.tradeStatus==0||t.tradeStatus==1?(a(),_(m,{key:0,type:"spinner",size:"48px"})):d("",!0),t.tradeStatus==2?(a(),_(w,{key:1,color:"#07c160",size:"40px",name:"checked"})):d("",!0),t.tradeStatus==-1||t.tradeStatus==-2?(a(),_(w,{key:2,color:"#FA5151",size:"40px",name:"clear"})):d("",!0)]),o("div",se,[f(n(e.$t("txHash")+":")+" ",1),t.tradeStatus==1||t.tradeStatus==2||t.tradeStatus==-2?(a(),r("text",oe,[o("span",{onClick:s[1]||(s[1]=(...p)=>i.jumpToTxDetail&&i.jumpToTxDetail(...p))},n(e.$f.formatAddress(t.tradeHash,6)),1),(a(),r("svg",{class:"icon-svg icon-renzheng","aria-hidden":"true",onClick:s[2]||(s[2]=p=>i.copy(t.tradeHash))},ie))])):t.tradeStatus==0||t.tradeStatus==-1?(a(),r("text",ne,ce)):d("",!0)]),t.tradeStatus==2||t.tradeStatus==-2?(a(),r("div",{key:0,class:"check-trade-list",onClick:s[3]||(s[3]=(...p)=>i.jumpToPaymentList&&i.jumpToPaymentList(...p))},n(e.$t("goToSeePaymentRecords")),1)):d("",!0)]))]),_:1},8,["visible","title","showConfirmButton","showCancelButton","onOnConfirm","confirmLoading"])}const de=k(z,[["render",le],["__scopeId","data-v-18bc2934"]]);const ue={name:"BecomeManager",props:{visible:Boolean},components:{},data(){return{}},computed:{dialogVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}},managerSeat(){return 5-this.$store.state.group.managers.length}},watch:{},methods:{becomeManager(){this.$store.commit("setTradeVisable",!0),this.$store.commit("setPaymentType",0),this.dialogVisible=!1}},created(){},mounted(){}},C=e=>(T("data-v-5ad3884f"),e=e(),A(),e),pe={class:"title"},he={class:"content"},me={class:"info"},_e={class:"privilege"},ye={class:"privilege-info"},fe={class:"privilege-list"},ge={class:"item"},ve=C(()=>o("div",{class:"img"},[o("i",{class:"iconfont icon-kick"})],-1)),be={class:"text"},ke={class:"item"},we=C(()=>o("div",{class:"img"},[o("i",{class:"iconfont icon-zhiding"})],-1)),Se={class:"text"},Te={class:"item"},Ae={class:"img"},Be={class:"text"},Ce={class:"item"},$e={class:"img"},Ve={class:"text"},Ie={class:"action-bar"};function Le(e,s,c,h,t,i){const m=l("van-icon"),g=l("van-button"),v=l("van-popup");return a(),_(v,{show:i.dialogVisible,"onUpdate:show":s[0]||(s[0]=b=>i.dialogVisible=b),closeable:!0,round:"",position:"center",teleport:"#app",class:"become-manager"},{default:y(()=>[o("h3",pe,n(e.$t("becomeAnAdmin")),1),o("div",he,[o("div",me,[f(n(e.$t("becomeAnAdminInfo1")),1),o("span",null,n(i.managerSeat),1),f(n(e.$t("becomeAnAdminInfo2")),1)]),o("div",_e,[o("div",ye,n(e.$t("becomeAnAdminInfo3")),1),o("div",fe,[o("div",ge,[ve,o("div",be,n(e.$t("banOrRemove")),1)]),o("div",ke,[we,o("div",Se,n(e.$t("pinMessage")),1)]),o("div",Te,[o("div",Ae,[u(m,{class:"icon-svg",size:"1.3em",name:"/assets/images/set.png"})]),o("div",Be,n(e.$t("managementGroup")),1)]),o("div",Ce,[o("div",$e,[u(m,{class:"icon-svg",size:"1.3em",name:"/assets/images/tequan.png"})]),o("div",Ve,n(e.$t("morePrivileges")),1)])])])]),o("div",Ie,[u(g,{type:"primary",class:"btn",onClick:i.becomeManager},{default:y(()=>[f(n(e.$t("confirm")),1)]),_:1},8,["onClick"])])]),_:1},8,["show"])}const xe=k(ue,[["render",Le],["__scopeId","data-v-5ad3884f"]]),Ne={name:"Group",components:{BlablaPay:de,BecomeManager:xe},computed:{becomeManagerVisible:{get(){return this.$store.state.group.becomeManagerVisible},set(e){this.$store.commit("setBecomeManagerVisible",e)}}},mounted(){console.log(this.$route.params.groupId)}};function Pe(e,s,c,h,t,i){const m=l("router-view"),g=l("become-manager"),v=l("BlablaPay");return a(),r(D,null,[u(m),u(g,{visible:i.becomeManagerVisible,"onUpdate:visible":s[0]||(s[0]=b=>i.becomeManagerVisible=b)},null,8,["visible"]),u(v)],64)}const Fe=k(Ne,[["render",Pe]]);export{Fe as default};
