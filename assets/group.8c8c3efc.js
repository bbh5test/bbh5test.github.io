import{_ as b,c as P,r as d,o,a as g,w as y,b as a,d as l,t as n,e as u,f as v,p as w,g as B,h as L,i as N,j as D,B as F,k,s as U,l as M,m as h,F as T}from"./index.334a89c2.js";import{D as $}from"./dialogBase.1146a7ec.js";const H={components:{DialogBase:$},props:{tradeStatus:{type:Number,default:999},tradeHash:{type:String,default:"N/A"}},emits:["closeBlablaPayStatus"],watch:{tradeStatus(){this.tradeStatus!==999&&(console.log(this.tradeStatusVisible),this.tradeStatusVisible=!0)},tradeStatusVisible(t){t||this.$emit("closeBlablaPayStatus")}},data(){return{tradeStatusVisible:!1}},methods:{copy:P,jumpToTxDetail(){window.open("https://rinkeby.etherscan.io/tx/"+this.tradeHash,"_blank")},jumpToPaymentList(){this.tradeStatusVisible=!1,this.$router.push({name:"PaymentList"})}}},C=t=>(w("data-v-6e5ed611"),t=t(),B(),t),z={class:"status-content"},W={class:"status-text"},j={key:0},x={key:1},E={key:2},O={key:3},R={class:"status-icon"},G={class:"trade-hash"},q={key:0},J=C(()=>a("use",{"xlink:href":"#icon-copy"},null,-1)),K=[J],Q={key:1},X=C(()=>a("span",null,"N/A",-1)),Y=[X];function Z(t,e,s,p,r,i){const _=d("van-loading"),m=d("van-icon"),f=d("DialogBase");return o(),g(f,{class:"trade-box",autoClose:!1,clickOverlayIsClose:!1,visible:r.tradeStatusVisible,"onUpdate:visible":e[3]||(e[3]=c=>r.tradeStatusVisible=c),title:t.$t("transactionDetails"),showConfirmButton:!1,showCancelButton:!1},{default:y(()=>[a("div",z,[a("div",W,[s.tradeStatus==0||s.tradeStatus==3?(o(),l("span",j,n(t.$t("sendingTransactionToBlockchain")),1)):s.tradeStatus==1?(o(),l("span",x,n(t.$t("waitingForServiceSyncronizing")),1)):s.tradeStatus==-1?(o(),l("span",E,n(t.$t("sendTransactionToBlockchainFailed")),1)):s.tradeStatus==-2?(o(),l("span",O,n(t.$t("servicesyncronizingTimeout")),1)):u("",!0)]),a("div",R,[s.tradeStatus==0||s.tradeStatus==1||s.tradeStatus==3?(o(),g(_,{key:0,type:"spinner",size:"48px"})):u("",!0),s.tradeStatus==2||s.tradeStatus==4?(o(),g(m,{key:1,color:"#07c160",size:"40px",name:"checked"})):u("",!0),s.tradeStatus==-1||s.tradeStatus==-2?(o(),g(m,{key:2,color:"#FA5151",size:"40px",name:"clear"})):u("",!0)]),a("div",G,[v(n(t.$t("txHash")+":")+" ",1),s.tradeStatus==1||s.tradeStatus==2||s.tradeStatus==-2||s.tradeStatus==3||s.tradeStatus==4?(o(),l("text",q,[a("span",{onClick:e[0]||(e[0]=(...c)=>i.jumpToTxDetail&&i.jumpToTxDetail(...c))},n(t.$f.formatAddress(s.tradeHash,6)),1),(o(),l("svg",{class:"icon-svg icon-renzheng","aria-hidden":"true",onClick:e[1]||(e[1]=c=>i.copy(s.tradeHash))},K))])):s.tradeStatus==0||s.tradeStatus==-1?(o(),l("text",Q,Y)):u("",!0)]),s.tradeStatus==2||s.tradeStatus==-2?(o(),l("div",{key:0,class:"check-trade-list",onClick:e[2]||(e[2]=(...c)=>i.jumpToPaymentList&&i.jumpToPaymentList(...c))},n(t.$t("goToSeePaymentRecords")),1)):u("",!0)])]),_:1},8,["visible","title"])}const tt=b(H,[["render",Z],["__scopeId","data-v-6e5ed611"]]);const et={name:"BlablaPay",inject:["reload"],components:{DialogBase:$,BlablaPayStatus:tt},data(){return{contractAddress:"0x1BEcc0D044267540e81C1d203Eb7875ED9ff120F",jfTokenAddress:"0xaf22F677373352761B7F8FAfF4c9aD7bd8B6Be42",tradeHash:"N/A",tradeStatus:999,payWay:0,unUsedNum:0,tokenId:"0",isShowApprove:!1,isShowButton:!1,isConfirmLoading:!1,isApproveLoading:!1}},watch:{"$store.state.group.tradeVisable"(t){t&&this.init()}},computed:{tradeVisable:{get(){return this.$store.state.group.tradeVisable},set(t){this.$store.commit("setTradeVisable",t)}},paymentType(){return this.$store.state.group.paymentType}},mounted(){},methods:{async init(){if(this.tradeHash="N/A",this.tradeStatus=999,this.payWay=0,this.unUsedNum=0,this.tokenId="0",this.isShowApprove=!1,this.isShowButton=!1,this.isConfirmLoading=!1,this.isApproveLoading=!1,!await this.$store.dispatch("getPaymentListAction"))this.payWay=2;else{let e=this.$store.state.user.paymentList;if(e.length==0)this.payWay=2;else{let s=0;for(let p of e)this.paymentType==0?p.status==0&&p.paymentType==0&&(s=s+1):this.paymentType==1&&p.status==0&&p.paymentType==1&&(s=s+1);s>0?(this.payWay=1,this.unUsedNum=s):this.payWay=2}}this.isShowButton=!0},async changeTokenId(){this.tokenId==0&&(this.isShowButton=!0,this.isShowApprove=!1)},async payConfirm(){if(this.isConfirmLoading=!0,this.payWay==1){let t=await this.trade();if(t=="fail")this.$toast.fail("\u652F\u4ED8\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u652F\u4ED8");else if(t=="success"){let e;this.paymentType==0?e="\u8D2D\u4E70\u7BA1\u7406\u5458\u6210\u529F":this.paymentType==1&&(e="\u8FDD\u89C4\u5904\u7F5A\u652F\u4ED8\u6210\u529F"),this.$toast.success(e),this.$store.commit("setTradeVisable",!1)}}else{console.log("\u6821\u9A8C\u7F51\u7EDC\u548C\u8D26\u6237");let t=await L();if(t=="netErr"){await N(),this.isConfirmLoading=!1;return}else if(t=="tokenErr"){this.$toast({duration:3e3,message:"\u8BF7\u5C06\u94B1\u5305\u8D26\u6237\u5207\u6362\u5230\u767B\u5F55\u7528\u6237"}),this.isConfirmLoading=!1;return}else if(t==!1){console.log("\u6CA1\u6709\u767B\u5F55\u6216\u8005\u83B7\u53D6\u8D26\u6237\u51FA\u9519\uFF0C\u91CD\u65B0\u767B\u5F55"),this.$store.state.wallet=="WalletConnect"&&await this.$store.state.provider.disconnect(),this.$store.commit("logout"),this.$store.commit("setUserInfo",{}),this.$store.commit("setTradeVisable",!1),this.$store.dispatch("checkLogin"),this.isConfirmLoading=!1;return}if(this.tokenId==1&&!await D({spender:this.contractAddress,tokenAddress:this.jfTokenAddress,account:this.$store.state.user.userAddress})){this.isShowButton=!1,this.isShowApprove=!0,this.$toast("\u8BF7\u5148\u6388\u6743"),this.isConfirmLoading=!1;return}this.$store.commit("setTradeVisable",!1),this.tradeStatus=0,this.isShowButton=!1;try{let e=await F(this.contractAddress,this.paymentType,parseInt(this.tokenId));e&&(console.log(e),this.tradeHash=e.hash,this.tradeStatus=1,await e.wait(),await this.timeCheckTrade())}catch(e){console.log(e),this.tradeStatus=-1}}this.isConfirmLoading=!1},async trade(){try{if(this.paymentType==0){if((await k.groupMember.buyManager(this.$store.state.group.groupId)).status==1)return await this.$store.dispatch("getGroupDetail",this.$route.params.groupId),this.$store.commit("setCurrentUserRole",1),"success"}else if(this.paymentType==1&&(await k.groupViolation.dealWithViolation(this.$store.state.group.groupId)).status==1)return this.$store.commit("setGroupStatus",0),this.$router.push({name:"GroupDetail",params:{groupId:this.$route.params.groupId}}),"success"}catch(t){console.log(t)}return"fail"},async timeCheckTrade(){console.log("timeCheckTrade");let t=!1,e=setTimeout(async function(){t=!0},6e4);for(;;){try{if(await this.trade()=="success"){this.tradeStatus=2,clearTimeout(e);break}}catch(s){console.log(s)}if(t){this.tradeStatus=-2;break}await U(3e3)}},async approve(){this.isApproveLoading=!0,this.tradeStatus=0;try{let t=await M(this.contractAddress,this.jfTokenAddress);t&&(this.tradeHash=t.hash,this.tradeStatus=3,await t.wait(),this.isShowApprove=!1,this.isShowButton=!0,this.tradeStatus=4),console.log(t)}catch(t){this.tradeStatus=-1,console.log(t)}finally{this.isApproveLoading=!1}},closeBlablaPayStatus(){this.tradeStatus==2&&this.reload(),this.tradeStatus=999,this.tradeHash="N/A"}}},st={key:0,class:"pay-way"},at={key:1,class:"has-unused"},it={key:0},ot={key:1},nt={key:2,class:"no-unused"},rt={key:0},lt={key:1},dt=v("approve");function ct(t,e,s,p,r,i){const _=d("van-loading"),m=d("van-radio"),f=d("van-radio-group"),c=d("van-button"),V=d("DialogBase"),I=d("BlablaPayStatus");return o(),l(T,null,[h(V,{class:"trade-box",autoClose:!1,clickOverlayIsClose:!1,visible:i.tradeVisable,"onUpdate:visible":e[1]||(e[1]=S=>i.tradeVisable=S),title:t.$t("tips"),showConfirmButton:r.isShowButton,showCancelButton:r.isShowButton,onOnConfirm:i.payConfirm,confirmLoading:r.isConfirmLoading},{default:y(()=>[r.tradeStatus==999?(o(),l("div",st,[r.payWay==0?(o(),g(_,{key:0,type:"spinner",size:"48px"})):r.payWay==1?(o(),l("div",at,[i.paymentType==1?(o(),l("span",it,n(t.$t("violationPaymentUnused",{num:r.unUsedNum})),1)):i.paymentType==0?(o(),l("span",ot,n(t.$t("adminPaymentUnused",{num:r.unUsedNum})),1)):u("",!0)])):r.payWay==2?(o(),l("div",nt,[a("label",null,[i.paymentType==1?(o(),l("span",rt,n(t.$t("chooseToPayForViolation")),1)):i.paymentType==0?(o(),l("span",lt,n(t.$t("chooseToPayForAmdin")),1)):u("",!0)]),h(f,{modelValue:r.tokenId,"onUpdate:modelValue":e[0]||(e[0]=S=>r.tokenId=S),onChange:i.changeTokenId},{default:y(()=>[h(m,{class:"radio-item","checked-color":"#9505F9","icon-size":"16px",name:"0"},{default:y(()=>[v(n(t.$t("pay"))+" 1 BNB",1)]),_:1}),h(m,{class:"radio-item","checked-color":"#9505F9","icon-size":"16px",name:"1"},{default:y(()=>[v(n(t.$t("pay"))+" 200 JF",1)]),_:1})]),_:1},8,["modelValue","onChange"])])):u("",!0),r.isShowApprove?(o(),g(c,{key:3,class:"approve",round:"",type:"primary",onClick:i.approve,loading:r.isApproveLoading},{default:y(()=>[dt]),_:1},8,["onClick","loading"])):u("",!0)])):u("",!0)]),_:1},8,["visible","title","showConfirmButton","showCancelButton","onOnConfirm","confirmLoading"]),h(I,{onCloseBlablaPayStatus:i.closeBlablaPayStatus,tradeStatus:r.tradeStatus,tradeHash:r.tradeHash},null,8,["onCloseBlablaPayStatus","tradeStatus","tradeHash"])],64)}const ut=b(et,[["render",ct],["__scopeId","data-v-bcaa139a"]]);const ht={name:"BecomeManager",props:{visible:Boolean},components:{},data(){return{}},computed:{dialogVisible:{get(){return this.visible},set(t){this.$emit("update:visible",t)}},managerSeat(){return 5-this.$store.state.group.managers.length}},watch:{},methods:{becomeManager(){this.$store.commit("setTradeVisable",!0),this.$store.commit("setPaymentType",0),this.dialogVisible=!1}},created(){},mounted(){}},A=t=>(w("data-v-f4b69b08"),t=t(),B(),t),mt={class:"title"},pt={class:"content"},_t={class:"info"},yt={class:"privilege"},ft={class:"privilege-info"},gt={class:"privilege-list"},vt={class:"item"},bt=A(()=>a("div",{class:"img"},[a("i",{class:"iconfont icon-kick"})],-1)),St={class:"text"},kt={class:"item"},wt=A(()=>a("div",{class:"img"},[a("i",{class:"iconfont icon-zhiding"})],-1)),Bt={class:"text"},Tt={class:"item"},$t={class:"img"},Ct={class:"text"},At={class:"item"},Vt={class:"img"},It={class:"text"},Pt={class:"action-bar"};function Lt(t,e,s,p,r,i){const _=d("van-icon"),m=d("van-button"),f=d("van-popup");return o(),g(f,{show:i.dialogVisible,"onUpdate:show":e[0]||(e[0]=c=>i.dialogVisible=c),closeable:!0,round:"",position:"center",teleport:"#app",class:"become-manager"},{default:y(()=>[a("h3",mt,n(t.$t("becomeAnAdmin")),1),a("div",pt,[a("div",_t,[v(n(t.$t("becomeAnAdminInfo1")),1),a("span",null,n(i.managerSeat),1),v(n(t.$t("becomeAnAdminInfo2")),1)]),a("div",yt,[a("div",ft,n(t.$t("becomeAnAdminInfo3")),1),a("div",gt,[a("div",vt,[bt,a("div",St,n(t.$t("banOrRemove")),1)]),a("div",kt,[wt,a("div",Bt,n(t.$t("pinMessage")),1)]),a("div",Tt,[a("div",$t,[h(_,{class:"icon-svg",size:"1.3em",name:"/assets/images/set.png"})]),a("div",Ct,n(t.$t("managementGroup")),1)]),a("div",At,[a("div",Vt,[h(_,{class:"icon-svg",size:"1.3em",name:"/assets/images/tequan.png"})]),a("div",It,n(t.$t("morePrivileges")),1)])])])]),a("div",Pt,[h(m,{type:"primary",class:"btn",onClick:i.becomeManager},{default:y(()=>[v(n(t.$t("becomeAdmin")),1)]),_:1},8,["onClick"])])]),_:1},8,["show"])}const Nt=b(ht,[["render",Lt],["__scopeId","data-v-f4b69b08"]]),Dt={name:"Group",components:{BlablaPay:ut,BecomeManager:Nt},computed:{becomeManagerVisible:{get(){return this.$store.state.group.becomeManagerVisible},set(t){this.$store.commit("setBecomeManagerVisible",t)}}},mounted(){console.log(this.$route.params.groupId)}};function Ft(t,e,s,p,r,i){const _=d("router-view"),m=d("become-manager"),f=d("BlablaPay");return o(),l(T,null,[h(_),h(m,{visible:i.becomeManagerVisible,"onUpdate:visible":e[0]||(e[0]=c=>i.becomeManagerVisible=c)},null,8,["visible"]),h(f)],64)}const Ht=b(Dt,[["render",Ft]]);export{Ht as default};
