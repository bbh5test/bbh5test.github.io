import{_,d as p,g as v,i as r,j as a,w as d,f as $,h as k,r as n,o as g,ad as b,x as w,p as y,l as L}from"./index.87365d20.js";import{E as S}from"./editAvatar.3754c28d.js";const E={name:"GroupSet",components:{EditAvatar:S},setup(){return{formatterSpace:o=>o.replace(/\s+/g,"")}},watch:{"$store.state.authorization"(){this.init()},"$store.state.group.groupId"(){console.log(2222),this.initGroupInfo(),this.isFirst=!0},"$store.state.group.image"(){this.groupInfo.image=this.$store.state.group.image},groupInfo:{handler:function(t,o){this.isFirst||(this.isEdit=!0),this.isFirst=!1},deep:!0}},data(){return{timer:null,isEdit:!1,isFirst:!0,groupInfo:{},updateLogoLoading:!1}},mounted(){this.$store.state.group.groupId||this.init(),console.log(111),this.initGroupInfo()},methods:{initGroupInfo(){this.groupInfo={groupId:this.$store.state.group.groupId,image:this.$store.state.group.image,address:this.$store.state.group.address,nickname:this.$store.state.group.nickname,description:this.$store.state.group.description}},async init(){this.isEdit=!1,this.isFirst=!0;try{await this.$store.dispatch("getGroupDetail",this.$route.params.groupId)}catch(t){console.log(t)}},async uoloadImg(t){if(this.updateLogoLoading)return;let o=this.$toast.loading({message:"Loading...",forbidClick:!0,duration:0});this.updateLogoLoading=!0;try{(await p.group.updateLogo(this.groupInfo.groupId,t)).status==1&&(console.log(222),await this.init())}catch(s){console.log(s)}finally{o.clear(),this.tipVisable=!1,this.updateLogoLoading=!1}},async submit(){if(!this.isEdit)return;let t=this.groupInfo.nickname,o=this.$toast.loading({message:"Loading...",forbidClick:!0,duration:0});try{let s=await p.group.updateInfo(this.groupInfo.groupId,t,this.groupInfo.description);console.log(s),s.status==1&&(console.log("success"),await this.init(),this.$router.push({name:"GroupDetail",params:{groupId:this.$route.params.groupId}}))}catch(s){console.log(s)}finally{o.clear()}console.log(this.groupInfo)}}},c=t=>(y("data-v-08c2c7d3"),t=t(),L(),t),V={class:"group-set"},x={class:"form-item"},G=c(()=>r("label",null,"\u7FA4\u6635\u79F0",-1)),C={class:"form-item"},F=c(()=>r("label",null,"\u63CF\u8FF0",-1));function z(t,o,s,m,e,u){const f=n("van-nav-bar"),h=n("EditAvatar"),l=n("van-field"),I=n("van-form");return g(),v("div",V,[r("div",null,[a(f,{"left-text":t.$t("cancel"),onClickLeft:o[1]||(o[1]=i=>t.$router.push({name:"GroupDetail",params:{groupId:t.$route.params.groupId}})),fixed:"",placeholder:"","safe-area-inset-top":"","z-index":"2",title:"\u7FA4\u8BBE\u7F6E"},{right:d(()=>[r("span",{class:"finish",onClick:o[0]||(o[0]=b(i=>t.$refs.form.submit(),["stop"])),style:w({color:e.isEdit?"#9505f9":"#999"})},"\u5B8C\u6210",4)]),_:1},8,["left-text"])]),r("div",null,[e.groupInfo.groupId?(g(),$(h,{key:0,image:e.groupInfo.image,defaultImg:e.groupInfo.groupId?`https://ave.s3.ap-east-1.amazonaws.com/token_icon/bsc/${t.$route.params.groupId.split("-")[0]}.png`:"",address:e.groupInfo.address,onGetImgFile:u.uoloadImg},null,8,["image","defaultImg","address","onGetImgFile"])):k("",!0),a(I,{class:"form-box",ref:"form",onSubmit:u.submit},{default:d(()=>[r("div",x,[G,a(l,{modelValue:e.groupInfo.nickname,"onUpdate:modelValue":o[2]||(o[2]=i=>e.groupInfo.nickname=i),formatter:m.formatterSpace,maxlength:"30",placeholder:"\u7FA4\u6635\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7FA4\u6635\u79F0"}]},null,8,["modelValue","formatter"])]),r("div",C,[F,a(l,{modelValue:e.groupInfo.description,"onUpdate:modelValue":o[3]||(o[3]=i=>e.groupInfo.description=i),rows:"3",autosize:"",type:"textarea",maxlength:"500",placeholder:"\u8F93\u5165\u63CF\u8FF0","show-word-limit":""},null,8,["modelValue"])])]),_:1},8,["onSubmit"])])])}const D=_(E,[["render",z],["__scopeId","data-v-08c2c7d3"]]);export{D as default};
