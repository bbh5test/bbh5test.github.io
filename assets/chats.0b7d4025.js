import{_ as N,k as _,d as u,b as a,m as l,f as T,t as c,w as g,r,o as d,F as w,x as M,a as f,e as m}from"./index.b2dfe4f8.js";import{A as I}from"./avatar.fbabc6b0.js";const $={name:"Chats",components:{Avatar:I},data(){return{refreshing:!1,loading:!1,finished:!1,chatList:[],pageSize:10,pageNumber:1}},methods:{getGroupTitle(e){return this.$f.getGroupShowName({address:e.groupId.split("-")[0],name:e.name,nickname:e.nickname})},showUnreadMsgCount(e){return e>99?"99+":e},async onNextPage(){console.log("onNextPage"),this.pageNumber++,await this.getChatList()},async onRefresh(){this.pageNumber=1,this.chatList=[],await this.getChatList(),this.refreshing=!1},linkToSearch(){this.$router.push("/search")},async getChatList(){let e=[];for(let i of Object.keys(this.$store.state.group.msgTimeList)){let h=i.split("_")[0],o=i.split("_")[1];h==this.$store.state.user.userAddress&&e.push({groupId:o,time:this.$store.state.group.msgTimeList[i]})}let s=await _.group.getMyGroups(this.pageSize,this.pageNumber,e);if(s.status==1){this.loading=!1,s.data.total<=this.pageSize*this.pageNumber?this.finished=!0:this.finished=!1;for(let h of s.data.groups)this.chatList.push(h)}},formatTimestamp(e){let s=this.$dayjs.unix(e);return s.isToday()?s.format("HH:mm"):s.isYesterday()?this.$t("yesterday")+" "+s.format("HH:mm"):s.format("YYYY-MM-DD HH:mm")},async exitChat(e){(await _.group.leave(e)).status==1&&(this.chatList=this.chatList.filter(i=>i.groupId!=e))},toChat(e){this.$router.push("/group/"+e+"/chat")}},mounted(){this.getChatList()}},S={class:"myChats-container"},V={class:"chat-content"},A={class:"search-bar"},H={class:"chats-container"},z=["onClick"],R={class:"avatar"},Y={class:"content"},B={class:"left"},G={class:"title"},U={class:"desc"},D={class:"info"},P={key:0,class:"time"},j={key:1,class:"unread"};function F(e,s,i,h,o,n){const v=r("van-nav-bar"),p=r("van-icon"),C=r("Avatar"),k=r("van-button"),y=r("van-swipe-cell"),b=r("van-list"),L=r("van-pull-refresh");return d(),u("section",S,[a("div",null,[l(v,{fixed:"","safe-area-inset-top":"","z-index":"2",title:e.$t("chats")},null,8,["title"])]),a("div",V,[a("div",A,[a("div",{class:"search",onClick:s[0]||(s[0]=(...t)=>n.linkToSearch&&n.linkToSearch(...t))},[l(p,{name:"search"}),T(" \xA0"+c(e.$t("search")),1)])]),a("div",H,[l(L,{modelValue:o.refreshing,"onUpdate:modelValue":s[2]||(s[2]=t=>o.refreshing=t),onRefresh:n.onRefresh},{default:g(()=>[l(b,{loading:o.loading,"onUpdate:loading":s[1]||(s[1]=t=>o.loading=t),finished:o.finished,"finished-text":e.$t("noMore"),onLoad:n.onNextPage,"immediate-check":!1},{default:g(()=>[(d(!0),u(w,null,M(o.chatList,t=>(d(),f(y,{key:t.groupId,class:"chat-item-cell"},{right:g(()=>[l(k,{class:"exit-chat",square:"",type:"danger",text:e.$t("exitChat"),onClick:x=>n.exitChat(t.groupId)},null,8,["text","onClick"])]),default:g(()=>[a("div",{class:"chat-item",onClick:x=>n.toChat(t.groupId)},[a("div",R,[l(C,{class:"avatar",image:t.image?t.image:e.$f.formatIcon(t.groupId),address:t.groupId.split("-")[0]},null,8,["image","address"])]),a("div",Y,[a("div",null,[a("div",B,[a("div",G,c(n.getGroupTitle(t)),1),t.providerCount>0?(d(),f(p,{key:0,class:"cert",size:"0.4rem",name:"/assets/images/certification.png"})):m("",!0)]),a("div",U,c(`${t.totalMembers}
                                                                                    ${e.$t("members")}, ${t.onlineMembers} ${e.$t("online")}`),1)]),a("div",D,[t.lastChatTime?(d(),u("div",P,c(n.formatTimestamp(t.lastChatTime)),1)):m("",!0),t.unreadMsgCount?(d(),u("div",j,[a("span",null,c(n.showUnreadMsgCount(t.unreadMsgCount)),1)])):m("",!0)])])],8,z)]),_:2},1024))),128))]),_:1},8,["loading","finished","finished-text","onLoad"])]),_:1},8,["modelValue","onRefresh"])])])])}const O=N($,[["render",F],["__scopeId","data-v-bd6d3ad3"]]);export{O as default};
