import{_ as T,d as I,c as N,g as i,i as r,j as s,ac as V,w as g,f as p,h as u,t as b,q as k,v as y,r as d,o as n,F as j,u as S,k as f,p as x,l as G}from"./index.68a2c8a6.js";import{M as z}from"./memberItem.672e8f18.js";import{A as U}from"./avatar.0dbdb42c.js";import"./roleTag.653a2c77.js";const A={name:"GroupDetail",inject:["reload"],components:{MemberItem:z,Avatar:U},watch:{},computed:{groupInfo(){var t;return(t=this.$store.state)==null?void 0:t.group}},mounted(){console.log(this.pageNumber),this.init()},data(){return{becomeManagerVisible:!1,groupMemberList:[],loading:!1,finished:!1,error:!1,pageSize:50,pageNumber:1}},methods:{async init(){let t=this.$toast.loading({message:"Loading...",forbidClick:!0,duration:0});this.loading=!1,this.finished=!1,this.error=!1,this.pageNumber=1;try{await this.getMemberList()}catch(o){console.log(o)}finally{t.clear()}},async getMemberList(){this.loading=!0;try{let t=this.groupInfo.groupId;if(!t)return;let o=await I.groupMember.getMemberList(t,this.pageSize,this.pageNumber,[0,1,2]);console.log(o),this.pageNumber==1&&(this.groupMemberList=[]),o.status==1?(this.groupMemberList=this.groupMemberList.concat(o.data),o.data.length<this.pageSize||this.groupMemberList.length>=this.groupInfo.totalMembers?this.finished=!0:(this.pageNumber++,console.log(this.pageNumber))):this.error=!0}catch{this.error=!0}finally{setTimeout(()=>{this.loading=!1},1e3)}},editGroup(){this.$router.push({name:"GroupSet",params:{groupId:this.groupInfo.groupId}})},shareLink(){let t=window.document.location.host+"/group/"+this.groupInfo.groupId+"/chat";N(t)},openBecomeManager(){this.$store.commit("setBecomeManagerVisible",!0)},jumpToViolation(){(this.groupInfo.status==2||this.groupInfo.status==3)&&this.$router.push({name:"DealWithViolation",params:{groupId:this.groupInfo.groupId}})},jumpToEditOfficial(){this.$router.push({name:"GroupOfficialSet",params:{groupId:this.groupInfo.groupId}})},jumpToBanned(){this.$router.push({name:"Banned",params:{groupId:this.groupInfo.groupId}})},jumpAddViolation(){this.$router.push({name:"AddViolation",params:{groupId:this.groupInfo.groupId}})},leaveGroup(){this.$dialog.confirm({title:"\u63D0\u793A",message:"\u662F\u5426\u9000\u51FA\u7FA4\u804A",confirmButtonText:"\u786E\u8BA4",confirmButtonColor:"#3F80F7",cancelButtonText:"\u53D6\u6D88"}).then(async()=>{try{(await I.group.leave(this.groupInfo.groupId)).status==1&&this.$router.push("/chats")}catch(t){console.log(t)}}).catch(()=>{})}}},h=t=>(x("data-v-4ecb67ef"),t=t(),G(),t),D={class:"group-detail"},F={class:"group-content"},J={class:"section-top"},E={class:"nickname"},O={key:0,class:"svg-box"},R={key:1,class:"svg-box"},W={class:"members"},q={class:"section-center"},H={key:0,class:"section-btn"},K=f("\u5206\u4EAB\u7FA4\u94FE\u63A5"),P=f("\u7BA1\u7406\u5458"),Q={key:0,class:"weigui-handle"},X={key:1,class:"official-renzheng"},Y={class:"left-title"},Z=h(()=>r("span",{class:"custom-title"},"\u5F00\u901A\u9879\u76EE\u5B98\u65B9\u8BA4\u8BC1",-1)),$={class:"svg-box"},ee={class:"member-box"},te=f(" \u67E5\u770B\u7981\u8A00\u5217\u8868 "),oe={class:"member-list"},re={key:2,class:"bottom-operate"},se={key:0,class:"type-1"},ae=h(()=>r("div",null,"\u5904\u7F5A\u8FDD\u89C4",-1)),ne=[ae],ie=h(()=>r("div",null,"\u9000\u51FA\u7FA4\u804A",-1)),le=[ie],ue={key:1,class:"type-2"};function de(t,o,ce,ge,l,e){const _=d("van-icon"),M=d("van-nav-bar"),C=d("Avatar"),m=d("van-image"),c=d("van-cell"),v=d("van-button"),L=d("MemberItem"),w=d("van-empty"),B=d("van-list");return n(),i("div",D,[r("div",null,[s(M,{onClickLeft:o[0]||(o[0]=a=>t.$router.push({name:"Chat",params:{groupId:t.$route.params.groupId}})),"left-arrow":"",fixed:"",placeholder:"","safe-area-inset-top":"","z-index":"2",title:"\u7FA4\u8BE6\u60C5"},V({_:2},[e.groupInfo.currentUser.role==1||e.groupInfo.currentUser.role==2?{name:"right",fn:g(()=>[e.groupInfo.currentUser.role==1||e.groupInfo.currentUser.role==2?(n(),p(_,{key:0,class:"icon",size:"1.6em",name:"/assets/images/edit.png",onClick:e.editGroup},null,8,["onClick"])):u("",!0)])}:void 0]),1024)]),r("div",null,[r("div",F,[r("div",J,[e.groupInfo.groupId?(n(),p(C,{key:0,class:"avatar",image:e.groupInfo.image?e.groupInfo.image:`https://ave.s3.ap-east-1.amazonaws.com/token_icon/bsc/${t.$route.params.groupId.split("-")[0]}.png`,address:e.groupInfo.address},null,8,["image","address"])):u("",!0),r("div",E,[r("span",null,b(t.$f.getGroupShowName({address:e.groupInfo.groupId.split("-")[0],name:e.groupInfo.name,nickname:e.groupInfo.nickname})),1),e.groupInfo.providers.length>0?(n(),i("div",O,[s(m,{class:"img","lazy-load":"",src:"/assets/images/certification.png"})])):u("",!0),e.groupInfo.type=="nft"?(n(),i("div",R,[s(m,{class:"img","lazy-load":"",src:"/assets/images/NFT.png"})])):u("",!0)]),r("div",W,b(e.groupInfo.totalMembers)+" \u6210\u5458 ",1)]),r("div",q,[s(c,{title:"Token\u540D\u79F0\uFF1A",border:!1,value:e.groupInfo.name},null,8,["value"]),s(c,{title:"\u94FE\u540D\u79F0\uFF1A",border:!1,value:e.groupInfo.chain},null,8,["value"]),s(c,{title:"\u5B98\u65B9\u7F51\u7AD9\uFF1A",border:!1,value:e.groupInfo.officialWebsiteUrl},null,8,["value"]),s(c,{title:"\u7B80\u4ECB\uFF1A",border:!1,value:e.groupInfo.description||""},null,8,["value"])]),e.groupInfo.isJoined?(n(),i("div",H,[s(v,{class:"share-btn btn",round:"",block:"","native-type":"submit",type:"default",onClick:e.shareLink},{default:g(()=>[K]),_:1},8,["onClick"]),k(s(v,{class:"admin-btn btn",round:"",block:"","native-type":"submit",onClick:e.openBecomeManager,type:"primary"},{default:g(()=>[P]),_:1},8,["onClick"]),[[y,e.groupInfo.managers.length<5&&e.groupInfo.currentUser.role==0]])])):u("",!0)]),e.groupInfo.isJoined?(n(),i("div",Q,[s(c,{title:"\u7FA4\u8FDD\u89C4\u5904\u7406","is-link":"","value-class":e.groupInfo.status==2||e.groupInfo.status==3?"active":"",value:e.groupInfo.status==2||e.groupInfo.status==3?"\u6709\u5904\u7F5A\uFF0C\u53BB\u5904\u7406":"\u65E0\u5904\u7F5A",onClick:e.jumpToViolation},null,8,["value-class","value","onClick"])])):u("",!0),e.groupInfo.isJoined?(n(),i("div",X,[e.groupInfo.providers.length==0||e.groupInfo.currentUser.role==2?(n(),p(c,{key:0,"is-link":"",onClick:e.jumpToEditOfficial},{title:g(()=>[r("div",Y,[Z,r("div",$,[s(m,{class:"img","lazy-load":"",src:"/assets/images/certification.png"})])])]),_:1},8,["onClick"])):u("",!0)])):u("",!0),r("div",ee,[s(c,{title:"\u7FA4\u6210\u5458("+e.groupInfo.totalMembers+")",border:!1},{"right-icon":g(()=>[r("span",{onClick:o[1]||(o[1]=(...a)=>e.jumpToBanned&&e.jumpToBanned(...a))},[te,s(_,{name:"arrow",class:"arrow-icon"})])]),_:1},8,["title"]),r("div",oe,[s(B,{loading:l.loading,"onUpdate:loading":o[2]||(o[2]=a=>l.loading=a),offset:"100","loading-text":t.$t("loading"),finished:l.finished,"finished-text":t.$t("noMore"),error:l.error,"onUpdate:error":o[3]||(o[3]=a=>l.error=a),"error-text":t.$t("errorText"),onLoad:e.getMemberList,"immediate-check":!1},{default:g(()=>[(n(!0),i(j,null,S(l.groupMemberList,(a,pe)=>(n(),p(L,{groupMemberItem:a,role:t.$store.state.user.role,userRole:t.$store.state.user.role},null,8,["groupMemberItem","role","userRole"]))),256)),k(s(w,{class:"empty",description:t.$t("emptyData")},null,8,["description"]),[[y,l.groupMemberList&&l.groupMemberList.length===0&&!l.loading]])]),_:1},8,["loading","loading-text","finished","finished-text","error","error-text","onLoad"])])]),e.groupInfo.isJoined?(n(),i("div",re,[t.$store.state.user.role==2||t.$store.state.user.role==3?(n(),i("div",se,[r("div",{class:"weigui",onClick:o[4]||(o[4]=(...a)=>e.jumpAddViolation&&e.jumpAddViolation(...a))},ne),r("div",{class:"out",onClick:o[5]||(o[5]=(...a)=>e.leaveGroup&&e.leaveGroup(...a))},le)])):(n(),i("div",ue,[r("div",{class:"out",onClick:o[6]||(o[6]=(...a)=>e.leaveGroup&&e.leaveGroup(...a))}," \u9000\u51FA\u7FA4\u804A ")]))])):u("",!0)])])}const ve=T(A,[["render",de],["__scopeId","data-v-4ecb67ef"]]);export{ve as default};
