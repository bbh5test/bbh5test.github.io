import{_,d as h,T as b,g as v,i,j as a,w as f,F as k,r as u,o as V,a6 as y,p as w,l as x}from"./index.c378eab7.js";import{D as E}from"./dialogBase.8ad30566.js";import{E as F}from"./editAvatar.6e3b76fd.js";const U={name:"UserInfoSet",components:{DialogBase:E,EditAvatar:F},setup(){return{formatterSpace:e=>e.replace(/\s+/g,"")}},watch:{"$store.state.user.userAddress"(){this.initUserInfo(),this.isFirst=!0},"$store.state.user.image"(){this.userInfo.image=this.$store.state.user.image},userInfo:{handler:function(t,e){this.userInfo=t,this.isFirst||(this.isEdit=!0),this.isFirst=!1},deep:!0}},data(){return{isFirst:!0,isEdit:!1,tipVisable:!1,isEditNickname:!1,userInfo:{},imgUrl:"",imgFile:void 0,type:null}},mounted(){this.initUserInfo()},methods:{initUserInfo(){this.userInfo={lastImageNicknameTime:this.$store.state.user.lastImageNicknameTime,userAddress:this.$store.state.user.userAddress,image:this.$store.state.user.image,nickname:this.$store.state.user.nickname,mobile:this.$store.state.user.mobile,website:this.$store.state.user.website,email:this.$store.state.user.email,bio:this.$store.state.user.bio}},emailValidator(t){return t?/^(?:[a-z\d]+[_\-\+\.]?)*[a-z\d]+@(?:([a-z\d]+\-?)*[a-z\d]+\.)+([a-z]{2,})+$/i.test(t):!0},checkIsEdit(){if(!(Date.now()/1e3-this.userInfo.lastImageNicknameTime>7*24*3600)){this.$toast("7\u5929\u5185\u4F60\u53EA\u80FD\u7F16\u8F91\u4E00\u6B21\u6635\u79F0\u548C\u5934\u50CF");return}this.isEditNickname=!0},getImgFile(t){this.imgFile=t,this.tipVisable=!0,this.type=0},async uploadAvatar(){let t=this.$toast.loading({message:"Loading...",forbidClick:!0,duration:0});try{(await h.user.updateLogo(this.imgFile)).status==1&&await this.$store.dispatch("getUserInfoAction")}catch(e){console.log(e)}finally{t.clear(),this.tipVisable=!1}},finish(){if(!this.emailValidator(this.userInfo.email)){this.$toast("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1");return}if(this.isEdit){let t=this.userInfo.nickname;t==this.$store.state.user.nickname?this.uploadInfo(t):(this.tipVisable=!0,this.type=1)}},async uploadInfo(t){let e=b.loading({message:"Loading...",forbidClick:!0,duration:0});try{let n=await h.user.updateInfo(t,this.userInfo.email,this.userInfo.mobile,this.userInfo.website,this.userInfo.bio);console.log(n),n.status==1&&(this.$store.dispatch("getUserInfoAction"),this.isEdit=!1,this.$router.push({name:"UserInfo"})),n.status==-4013&&(this.userInfo.nickname=this.$store.state.user.nickname)}catch(n){console.log(n)}finally{e.clear(),this.tipVisable=!1}},async submit(){if(this.type==0)this.uploadAvatar();else if(this.type==1){let t=this.userInfo.nickname;this.uploadInfo(t)}},completeWebsiteFn(){this.userInfo.website=this.$f.completeWebsite(this.userInfo.website)}}},r=t=>(w("data-v-2e5fdf57"),t=t(),x(),t),C={class:"userinfo-set"},A={class:"form-item"},N=r(()=>i("label",null,[i("text",null,"\u7528\u6237\u6635\u79F0"),i("text",null,"*7\u5929\u5185\u4F60\u53EA\u80FD\u7F16\u8F91\u4E00\u6B21\u6635\u79F0\u548C\u5934\u50CF")],-1)),S={class:"form-item"},B=r(()=>i("label",null,"\u624B\u673A\u53F7",-1)),z={class:"form-item"},T=r(()=>i("label",null,"\u7F51\u7AD9",-1)),D={class:"form-item"},L=r(()=>i("label",null,"\u90AE\u7BB1",-1)),W={class:"form-item"},G=r(()=>i("label",null,"\u4E2A\u4EBA\u7B80\u4ECB",-1)),O=r(()=>i("div",{class:"tip-info"}," \u4E00\u65E6\u4F60\u4FEE\u6539\u4E86\u5934\u50CF\u6216\u6635\u79F0\uFF0C\u4F60\u9700\u8981\u7B49\u5F857\u5929\u540E\u624D\u80FD\u518D\u4FEE\u6539\u5B83\u4EEC\uFF08\u5934\u50CF/\u6635\u79F0\uFF09\u3002 ",-1));function $(t,e,n,d,s,l){const c=u("van-nav-bar"),p=u("EditAvatar"),m=u("van-field"),I=u("van-form"),g=u("DialogBase");return V(),v(k,null,[i("div",C,[i("div",null,[a(c,{"left-text":"\u53D6\u6D88",onClickLeft:e[1]||(e[1]=o=>t.$router.push({name:"UserInfo"})),placeholder:"",fixed:"","safe-area-inset-top":"","z-index":"2",title:"\u4E2A\u4EBA\u7F16\u8F91"},{right:f(()=>[i("span",{class:"finish",onClick:e[0]||(e[0]=(...o)=>l.finish&&l.finish(...o)),style:y({color:s.isEdit?"#9505f9":"#999"})},"\u5B8C\u6210",4)]),_:1})]),i("div",null,[a(p,{image:s.userInfo.image,lastImageNicknameTime:s.userInfo.lastImageNicknameTime,address:s.userInfo.userAddress,onGetImgFile:l.getImgFile},null,8,["image","lastImageNicknameTime","address","onGetImgFile"]),a(I,{class:"form-box"},{default:f(()=>[i("div",A,[N,a(m,{onClick:l.checkIsEdit,readonly:!s.isEditNickname,modelValue:s.userInfo.nickname,"onUpdate:modelValue":e[2]||(e[2]=o=>s.userInfo.nickname=o),maxlength:"50",formatter:d.formatterSpace,placeholder:"\u8F93\u5165\u6635\u79F0"},null,8,["onClick","readonly","modelValue","formatter"])]),i("div",S,[B,a(m,{modelValue:s.userInfo.mobile,"onUpdate:modelValue":e[3]||(e[3]=o=>s.userInfo.mobile=o),type:"number",maxlength:"30",placeholder:"\u8F93\u5165\u624B\u673A\u53F7"},null,8,["modelValue"])]),i("div",z,[T,a(m,{modelValue:s.userInfo.website,"onUpdate:modelValue":e[4]||(e[4]=o=>s.userInfo.website=o),onBlur:e[5]||(e[5]=o=>l.completeWebsiteFn()),maxlength:"300",type:"text",placeholder:"\u8F93\u5165\u7F51\u5740"},null,8,["modelValue"])]),i("div",D,[L,a(m,{modelValue:s.userInfo.email,"onUpdate:modelValue":e[6]||(e[6]=o=>s.userInfo.email=o),maxlength:"100",type:"email",placeholder:"\u8F93\u5165\u90AE\u7BB1",rules:[{validator:l.emailValidator,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u90AE\u7BB1\u5730\u5740"}]},null,8,["modelValue","rules"])]),i("div",W,[G,a(m,{modelValue:s.userInfo.bio,"onUpdate:modelValue":e[7]||(e[7]=o=>s.userInfo.bio=o),formatter:d.formatterSpace,rows:"3",autosize:"",type:"textarea",maxlength:"300",placeholder:"\u4E3B\u4EBA\u6BD4\u8F83\u61D2","show-word-limit":""},null,8,["modelValue","formatter"])])]),_:1})])]),a(g,{visible:s.tipVisable,"onUpdate:visible":e[8]||(e[8]=o=>s.tipVisable=o),title:"\u63D0\u793A",showConfirmButton:!0,showCancelButton:!0,autoClose:!1,onOnConfirm:l.submit},{default:f(()=>[O]),_:1},8,["visible","onOnConfirm"])],64)}const J=_(U,[["render",$],["__scopeId","data-v-2e5fdf57"]]);export{J as default};
